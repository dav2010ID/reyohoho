import{_ as T,c as n,d as o,g as i,t as x,e as g,w as f,x as A,v as U,o as E,p as M,aY as N,P,U as _,ai as R,l,M as b,b as u,h as y}from"./index-BFDMGJMO.js";const H={name:"AuthSuccess",setup(){const r=b(),e=A(),p=U(),s=l(!0),a=l(!1),c=l(!1),t=l(null),w=l("/reyohoho/"),S=async()=>{try{const v=new URLSearchParams(window.location.search).get("token");if(!v)throw new Error("Токен авторизации не найден");e.setToken(v),window.history.replaceState({},document.title,"".concat(w.value,"auth-success"));let k=await N();e.setUser(k);let h=await P(_.HISTORY);if(console.log("response.length: ".concat(h.length)),h.length!==0){s.value=!1,c.value=!0,setTimeout(async()=>{await r.push({path:"/"}),r.go(0)},2e3);return}s.value=!1,a.value=!0;try{for(const m of[...p.history].reverse())await R(m.kp_id,_.HISTORY)}catch(m){console.error("Auth error:",m),t.value="Произошла ошибка при переноси истории, попробуйте позднее...",a.value=!1}a.value=!1,c.value=!0,setTimeout(async()=>{await r.push({path:"/"}),r.go(0)},2e3),console.log(h)}catch(d){console.error("Auth error:",d),t.value=d.message,s.value=!1}};return E(()=>{S()}),{loading:s,success:c,moveHistory:a,error:t}}},I={class:"auth-success-container"},L={key:0,class:"loading-message"},V={key:1,class:"loading-message2"},Y={key:2,class:"error-message"},B={key:3,class:"success-message"};function C(r,e,p,s,a,c){const t=M("router-link");return u(),n("div",I,[s.loading?(u(),n("div",L,[...e[0]||(e[0]=[o("p",null,"Происходит авторизация...",-1),o("div",{class:"spinner"},null,-1)])])):i("",!0),s.moveHistory?(u(),n("div",V,[...e[1]||(e[1]=[o("p",null,"Переносим историю...",-1),o("div",{class:"spinner"},null,-1)])])):i("",!0),s.error?(u(),n("div",Y,[o("p",null,"Ошибка авторизации: "+x(s.error),1),g(t,{to:"/login",class:"retry-button"},{default:f(()=>[...e[2]||(e[2]=[y("Попробовать снова",-1)])]),_:1})])):i("",!0),s.success?(u(),n("div",B,[e[4]||(e[4]=o("p",null,"Авторизация прошла успешно!",-1)),g(t,{to:"/",class:"home-button"},{default:f(()=>[...e[3]||(e[3]=[y("На главную",-1)])]),_:1})])):i("",!0)])}const D=T(H,[["render",C],["__scopeId","data-v-f30093c3"]]);export{D as default};
