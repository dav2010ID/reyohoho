import{s as j}from"./htmlSanitizer-Cf6jTOTR.js";function w(){const f=r=>{try{const t=new URL(r);return t.hostname==="cdn.7tv.app"&&t.protocol==="https:"||t.hostname==="cdn.rte.net.ru"&&t.protocol==="https:"||t.hostname==="starege.rte.net.ru"&&t.protocol==="https:"||t.pathname.includes("/api/7tv")&&t.protocol==="https:"?r:(console.warn("URL изображения отклонен:",{url:r,hostname:t.hostname,protocol:t.protocol,reason:t.hostname!=="cdn.7tv.app"?"неразрешенный домен":"неразрешенный протокол"}),!1)}catch(t){return console.warn("Недопустимый URL изображения:",r,"Ошибка:",t.message),!1}},e=r=>{const t=document.createElement("div");return t.textContent=r,t.innerHTML},U=r=>{if(!r)return"";let t=r;return t=t.replace(/\[spoiler\]\s*\[\/spoiler\]/g,""),t=t.replace(/\[img\]\s*\[\/img\]/g,""),t=t.replace(/\[link=[^\]]+\]\s*\[\/link\]/g,""),t=t.replace(new RegExp("\\[spoiler\\](.*?)\\[\\/spoiler\\]","gs"),(l,c,s,n)=>{const o=c.trim();if(!o)return"";const h=o.split(/(\[img\].*?\[\/img\]|\[link=.*?\[\/link\])/).filter(Boolean).map(m=>m.startsWith("[img]")?m.replace(/\[img\](.*?)\[\/img\]/g,(v,g)=>{const u=g.trim(),i=f(u);if(i&&i!==!1){const a=e(i);return'<span class="spoiler-hidden-content"><img src="'.concat(a,'" alt="7TV emote" class="inline-emoji" loading="lazy" /></span>')}return"[недопустимое изображение: ".concat(e(u),"]")}):m.startsWith("[link=")?m.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(v,g,u)=>{const i=g.trim(),a=u.trim();if(!a)return"";if(/^https?:\/\//.test(i)&&a){const R=e(i),b=e(a);return'<a href="'.concat(R,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(b,"</a>")}return e(a||i)}):e(m)).join(""),p=s>0?n[s-1]:" ",d=s+l.length<n.length?n[s+l.length]:" ",$=p&&p!==" "&&p!=="\n"&&p!=="	",T=d&&d!==" "&&d!=="\n"&&d!=="	",V=$?" ":"",x=T?" ":"";return"".concat(V,'<span class="spoiler-text" data-spoiler="true" title="Нажмите, чтобы показать спойлер">').concat(h,"</span>").concat(x)}),t=t.replace(/\[img\](.*?)\[\/img\]/g,(l,c)=>{const s=c.trim(),n=f(s);if(n&&n!==!1){const o=e(n);return'<img src="'.concat(o,'" alt="7TV emote" class="inline-emoji" loading="lazy" />')}return"[недопустимое изображение: ".concat(e(s),"]")}),t=t.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(l,c,s)=>{const n=c.trim(),o=s.trim();if(!o)return"";if(/^https?:\/\//.test(n)&&o){const k=e(n),h=e(o);return'<a href="'.concat(k,'" target="_blank" rel="noopener noreferrer" class="comment-link">').concat(h,"</a>")}return e(o||n)}),j(t)};return{formatContent:U,formatContentWithTruncation:r=>r?U(r):"",isValidImageUrl:f,escapeHtml:e}}export{w as u};
