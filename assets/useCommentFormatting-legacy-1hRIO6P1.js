System.register([],function(e,t){"use strict";return{execute:function(){e("u",function(){var e=e=>{try{var t=new URL(e);return"cdn.7tv.app"===t.hostname&&"https:"===t.protocol||"cdn.rte.net.ru"===t.hostname&&"https:"===t.protocol||"starege.rte.net.ru"===t.hostname&&"https:"===t.protocol||t.pathname.includes("/api/7tv")&&"https:"===t.protocol?e:(console.warn("URL изображения отклонен:",{url:e,hostname:t.hostname,protocol:t.protocol,reason:"cdn.7tv.app"!==t.hostname?"неразрешенный домен":"неразрешенный протокол"}),!1)}catch(r){return console.warn("Недопустимый URL изображения:",e,"Ошибка:",r.message),!1}},t=e=>{var t=document.createElement("div");return t.textContent=e,t.innerHTML},r=r=>{if(!r)return"";var n=r;return n=(n=(n=(n=(n=(n=n.replace(/\[spoiler\]\s*\[\/spoiler\]/g,"")).replace(/\[img\]\s*\[\/img\]/g,"")).replace(/\[link=[^\]]+\]\s*\[\/link\]/g,"")).replace(/\[spoiler\]([^]*?)\[\/spoiler\]/g,(r,n,a,i)=>{var l=n.trim();if(!l)return"";var o=l.split(/(\[img\].*?\[\/img\]|\[link=.*?\[\/link\])/).filter(Boolean).map(r=>r.startsWith("[img]")?r.replace(/\[img\](.*?)\[\/img\]/g,(r,n)=>{var a=n.trim(),i=e(a);return i&&!1!==i?`<span class="spoiler-hidden-content"><img src="${t(i)}" alt="7TV emote" class="inline-emoji" loading="lazy" /></span>`:`[недопустимое изображение: ${t(a)}]`}):r.startsWith("[link=")?r.replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(e,r,n)=>{var a=r.trim(),i=n.trim();return i?/^https?:\/\//.test(a)&&i?`<a href="${t(a)}" target="_blank" rel="noopener noreferrer" class="comment-link">${t(i)}</a>`:t(i||a):""}):t(r)).join(""),s=a>0?i[a-1]:" ",c=a+r.length<i.length?i[a+r.length]:" ";return`${s&&" "!==s&&"\n"!==s&&"\t"!==s?" ":""}<span class="spoiler-text" onclick="this.classList.toggle('revealed')" title="Нажмите, чтобы показать спойлер">${o}</span>${c&&" "!==c&&"\n"!==c&&"\t"!==c?" ":""}`})).replace(/\[img\](.*?)\[\/img\]/g,(r,n)=>{var a=n.trim(),i=e(a);return i&&!1!==i?`<img src="${t(i)}" alt="7TV emote" class="inline-emoji" loading="lazy" />`:`[недопустимое изображение: ${t(a)}]`})).replace(/\[link=([^\]]+)\](.*?)\[\/link\]/g,(e,r,n)=>{var a=r.trim(),i=n.trim();return i?/^https?:\/\//.test(a)&&i?`<a href="${t(a)}" target="_blank" rel="noopener noreferrer" class="comment-link">${t(i)}</a>`:t(i||a):""})};return{formatContent:r,formatContentWithTruncation:e=>e?r(e):"",isValidImageUrl:e,escapeHtml:t}})}}});
