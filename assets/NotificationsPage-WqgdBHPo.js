import{_ as $,p as w,b as e,c as o,d as t,e as b,w as p,g as l,h as N,t as h,D as u,a2 as M,n as S,aN as A,x as I,o as L,a as E,m as x,E as T,F as B,r as H,M as P,k as V,l as D}from"./index-K9ILig-E.js";import{u as F}from"./useCommentFormatting-ejlhXhIB.js";import{S as q}from"./SpinnerLoading-s9S-IcgQ.js";import"./htmlSanitizer-Cf6jTOTR.js";const U={class:"notification-content"},j={key:0,class:"movie-poster"},z=["src","alt"],O={class:"notification-main"},G={class:"notification-header"},J={class:"notification-info"},K={class:"notification-time"},Q={class:"notification-message"},W={key:0,class:"original-comment"},X=["innerHTML"],Y={key:1,class:"reply-comment"},Z=["innerHTML"],tt={class:"notification-actions"},it={key:0,class:"unread-indicator"},et={__name:"NotificationItem",props:{notification:{type:Object,required:!0}},emits:["mark-read","delete"],setup(i,{emit:a}){const v=i,k=a,{formatContent:m}=F(),r=c=>c?m(c):"",d=()=>{k("mark-read",v.notification.id)},_=()=>{k("delete",v.notification.id)},y=c=>{const n=c.target.closest(".spoiler-text");n&&n.classList.toggle("revealed")};return(c,n)=>{const g=w("router-link");return e(),o("div",{class:S(["notification-item",{unread:!i.notification.is_read,read:i.notification.is_read}])},[t("div",U,[i.notification.movie_cover?(e(),o("div",j,[b(g,{to:"/movie/".concat(i.notification.movie_id)},{default:p(()=>[t("img",{src:i.notification.movie_cover,alt:i.notification.movie_title,class:"poster-img"},null,8,z)]),_:1},8,["to"])])):l("",!0),t("div",O,[t("div",G,[t("div",J,[b(g,{to:"/movie/".concat(i.notification.movie_id),class:"movie-title"},{default:p(()=>[N(h(i.notification.movie_title),1)]),_:1},8,["to"])]),t("div",K,h(u(M)(i.notification.created_at)),1)]),t("div",Q,h(i.notification.message),1),i.notification.comment_content||i.notification.reply_content?(e(),o("div",{key:0,class:"comment-preview",onClick:y},[i.notification.comment_content?(e(),o("div",W,[n[0]||(n[0]=t("i",{class:"fas fa-quote-left"},null,-1)),t("span",{class:"comment-text",innerHTML:r(i.notification.comment_content)},null,8,X)])):l("",!0),i.notification.reply_content?(e(),o("div",Y,[n[1]||(n[1]=t("i",{class:"fas fa-reply"},null,-1)),t("span",{class:"comment-text",innerHTML:r(i.notification.reply_content)},null,8,Z)])):l("",!0)])):l("",!0)]),t("div",tt,[i.notification.is_read?l("",!0):(e(),o("button",{key:0,class:"action-btn mark-read-btn",title:"Отметить как прочитанное",onClick:d},[...n[2]||(n[2]=[t("i",{class:"fas fa-check"},null,-1)])])),t("button",{class:"action-btn delete-btn",title:"Удалить уведомление",onClick:_},[...n[3]||(n[3]=[t("i",{class:"fas fa-trash"},null,-1)])])])]),i.notification.is_read?l("",!0):(e(),o("div",it))],2)}}},ot=$(et,[["__scopeId","data-v-3b833b4e"]]),nt={class:"notifications-page"},at={class:"container"},st={class:"notifications-header"},ct={key:0,class:"header-actions"},lt=["disabled"],rt={key:0,class:"loading-container"},dt={key:2,class:"empty-state"},ft={key:3,class:"notifications-list"},mt={__name:"NotificationsPage",setup(i){const a=A(),v=I(),k=P(),m=D(!1),r=V(()=>a.notifications);L(async()=>{if(!v.token){k.push("/login");return}await c(),_()}),E(()=>{y()});let d=null;function _(){d=setInterval(()=>{a.fetchUnreadCount()},1e3*60*5)}function y(){d&&(clearInterval(d),d=null)}async function c(){await a.fetchNotifications()}async function n(){m.value=!0;try{await a.markAsRead()}catch(f){console.error("Error marking all as read:",f)}finally{m.value=!1}}async function g(f){try{await a.markAsRead([f])}catch(s){console.error("Error marking notification as read:",s)}}async function R(f){try{await a.deleteNotification(f)}catch(s){console.error("Error deleting notification:",s)}}return(f,s)=>(e(),o("div",nt,[t("div",at,[t("div",st,[s[1]||(s[1]=t("h1",{class:"page-title"},[t("i",{class:"fas fa-bell"}),N(" Уведомления ")],-1)),r.value.length>0?(e(),o("div",ct,[u(a).unreadCount>0?(e(),o("button",{key:0,class:"btn",disabled:m.value,onClick:n},[...s[0]||(s[0]=[t("i",{class:"fas fa-check-double"},null,-1),N(" Отметить все как прочитанные ",-1)])],8,lt)):l("",!0)])):l("",!0)]),u(a).loading?(e(),o("div",rt,[b(q),s[2]||(s[2]=t("p",{class:"loading-text"},"Загрузка уведомлений...",-1))])):u(a).error?(e(),x(T,{key:1,message:u(a).error,onRetry:c},null,8,["message"])):r.value.length===0?(e(),o("div",dt,[...s[3]||(s[3]=[t("i",{class:"fas fa-bell-slash empty-icon"},null,-1),t("h3",{class:"empty-title"},"Нет уведомлений",-1),t("p",{class:"empty-text"}," Когда кто-то ответит на ваш комментарий, вы увидите уведомление здесь ",-1)])])):(e(),o("div",ft,[(e(!0),o(B,null,H(r.value,C=>(e(),x(ot,{key:C.id,notification:C,onMarkRead:g,onDelete:R},null,8,["notification"]))),128))]))])]))}},_t=$(mt,[["__scopeId","data-v-322b1869"]]);export{_t as default};
