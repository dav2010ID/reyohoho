import{_ as qt,b as w,c as S,d as n,h as Ye,t as k,F as qe,r as nt,n as _,g as oe,s as pt,l as m,k as ae,v as co,x as Qo,S as en,M as uo,A as et,o as vo,X as tn,m as Lt,E as on,f as so,u as ee,Y as te,D as be,U as Y,e as Dt,aB as nn,aC as sn,J as io,$ as _t,aD as lo,aE as ln,ak as an,ai as rn,am as ao,au as tt,ad as cn,aF as un,aG as ro}from"./index-DvcZVGze.js";import{S as dn}from"./SpinnerLoading-CebXSRo8.js";import{N as po}from"./ToastMessage-rdpJsdUz.js";import{u as vn,S as pn}from"./player-DzNpamnt.js";import{_ as mn}from"./icon-imdb-logo-5qtstUwS.js";const Us="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/ElEQVR4nO2ZQUoDMRSGR7eewHoFsVS0HkUUXNXqASqK2EURBPFIVRe6c+UN1CvUXWvbT4KvMAwzNnnJdCrmg1BKad7/v7y0b5IkiUQiCwGoAx3gQjEugZ0qxTeAIX6MKjMBnBOGS62AVWAPOHVYdlMu9YArYOhphLeBT+ALmOKGEd2QubaAK+B2zngFxt4GgDXgGZjgR8ch5oEkCi8DkvlnRcYLV0Apfqw10M7JvPkV6AN3FmVwK+WyZRnvMEe8ef/ibECyb2o+zRuwnpQAxeLNivQ0BvYyE46qEJ/8fK4ycJKp/X4V4n0MdDNfukkqEO9jwP1LDgD7BeKPgmgp04CL+KUz4Cp+qQxoxC+NAdsNm4c0hWkukkUa8BGfegiadbFDq3/2UAZ8xc+QVvzMtqcKYkBaZ5/MN5xEl2DgLGDZ1KswsC09FPJqXTZoNm5oA6kyMGI2FxqfkluJ0uMTDfhBXAHiHvCCWEL8/RLqlv1MPCf+TSZ+13WC7KnEfWlqcwAeU7GNjnbiQsG5UC1ZAEAt1UMhOpquk6zknMy9l20C2AA+MnEHRo9msuOCs9EH4Fp5TVQ0rqVs0plH4re02Qh1Oq1lCjypsp+5H3gKcD/gykTirqnFZ/ZDy+OGxpapzD+QePrM/2KkKfcGPcv7AdvRkz23G1x4JPIP+AY3r/ywUk/2JAAAAABJRU5ErkJggg==",Ks="/reyohoho/assets/icon-shikimori-DGvXK9Jc.svg",ot=D=>{const l=document.createElement("div");l.style.position="fixed",l.style.top="0",l.style.left="0",l.style.width="100%",l.style.height="100%",l.style.backgroundColor="rgba(0, 0, 0, 0.8)",l.style.color="white",l.style.display="flex",l.style.justifyContent="center",l.style.alignItems="center",l.style.fontSize="2rem",l.style.zIndex="99000",l.textContent=D,document.body.appendChild(l),setTimeout(()=>{document.body.removeChild(l)},2e3)},fn={key:0},gn={key:1},yn={class:"players-list"},hn=["onClick"],bn={key:0,class:"warning-icon material-icons",title:"–í–Ω–∏–º–∞–Ω–∏–µ!"},wn=["onClick"],kn={key:0,class:"warning-icon material-icons",title:"–í–Ω–∏–º–∞–Ω–∏–µ!"},xn=["onClick"],Sn={key:0,class:"warning-icon material-icons",title:"–í–Ω–∏–º–∞–Ω–∏–µ!"},Cn={__name:"PlayerModal",props:{players:{type:Array,required:!0},selectedPlayer:{type:Object,default:null}},emits:["close","select"],setup(D,{emit:l}){const v=D,r=l,g=m(null),x=ae(()=>{const I=[],z=new Set;for(const E of v.players)L(E)?z.has("veoveo")||(I.push({type:"group",name:"veoveo",displayName:"VeoVeo"}),z.add("veoveo")):$(E)?z.has("kodik")||(I.push({type:"group",name:"kodik",displayName:"Kodik"}),z.add("kodik")):I.push({type:"player",data:E});return I}),L=I=>I.name.toUpperCase().includes("VEOVEO"),$=I=>I.name.toUpperCase().includes("KODIK"),d=I=>I.replace(/VEOVEO>/,"").replace(/KODIK>/,"").trim(),W=I=>{r("select",I),r("close")},X=I=>v.selectedPlayer&&v.selectedPlayer.key===I.key,M=I=>v.selectedPlayer?I==="veoveo"&&L(v.selectedPlayer)||I==="kodik"&&$(v.selectedPlayer):!1,re=I=>{g.value=I},V=()=>{g.value=null},B=I=>{let z=v.players.filter(E=>I==="veoveo"&&L(E)||I==="kodik"&&$(E));return I==="kodik"?z.sort((E,Ce)=>d(E.translate).localeCompare(d(Ce.translate))):z},b=I=>B(I).some(z=>z.warning);return(I,z)=>(w(),S("div",{class:"modal",onClick:z[2]||(z[2]=pt(E=>I.$emit("close"),["self"]))},[n("div",{class:"modal-content",onClick:z[1]||(z[1]=pt(()=>{},["stop"]))},[n("button",{class:"close",onClick:z[0]||(z[0]=E=>I.$emit("close"))},"√ó"),g.value?(w(),S("h2",gn,[n("button",{class:"back-btn",onClick:V},"‚Üê –ù–∞–∑–∞–¥"),Ye(" "+k(g.value),1)])):(w(),S("h2",fn,"–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–µ–µ—Ä")),n("ul",yn,[g.value?(w(!0),S(qe,{key:1},nt(B(g.value),E=>(w(),S("li",{key:E.key},[n("button",{class:_(["player-item",{active:X(E)}]),onClick:Ce=>W(E)},[Ye(k(d(E.translate))+" ",1),E.warning?(w(),S("span",Sn,"warning")):oe("",!0)],10,xn)]))),128)):(w(!0),S(qe,{key:0},nt(x.value,E=>(w(),S("li",{key:E.type==="player"?E.data.key:E.name},[E.type==="player"?(w(),S("button",{key:0,class:_(["player-item",{active:X(E.data)}]),onClick:Ce=>W(E.data)},[Ye(k(d(E.data.translate))+" ",1),E.data.warning?(w(),S("span",bn,"warning")):oe("",!0)],10,hn)):(w(),S("button",{key:1,class:_(["group-item",{active:M(E.name)}]),onClick:Ce=>re(E.name)},[z[3]||(z[3]=n("span",{class:"material-icons group-icon"},"folder",-1)),Ye(" "+k(E.displayName)+" ",1),b(E.name)?(w(),S("span",kn,"warning")):oe("",!0)],10,wn))]))),128))])])]))}},In=qt(Cn,[["__scopeId","data-v-4c8cca9d"]]);class En{constructor(){this.ws=null,this.isConnected=!1,this.isAuthenticated=!1,this.messageId=0,this.sources=new Map,this.filtersFound=new Map,this.pendingRequests=new Map,this.callbacks={onConnect:null,onDisconnect:null,onSourcesUpdated:null,onFiltersFound:null,onError:null},this.BLUR_FILTER_NAME="reyohoho"}generateMessageId(){return++this.messageId}setCallbacks(l){this.callbacks=l}async connect(l="localhost",v=4455,r=""){return new Promise((g,x)=>{const L="ws://".concat(l,":").concat(v);console.log("Connecting to OBS WebSocket at ".concat(L)),this.ws=new WebSocket(L),this.ws.onopen=async()=>{var $,d;console.log("WebSocket connection opened");try{const W=await this.authenticate(r);console.log("Authentication response:",W),W.success?(console.log("Successfully authenticated to OBS"),(d=($=this.callbacks).onConnect)==null||d.call($),this.loadSourcesAndSearchFilters(),g()):(console.error("Authentication failed"),x(new Error("Authentication failed")))}catch(W){console.error("Error during authentication:",W),x(W)}},this.ws.onmessage=$=>{this.handleMessage(JSON.parse($.data))},this.ws.onclose=()=>{var $,d;console.log("WebSocket connection closed"),(d=($=this.callbacks).onDisconnect)==null||d.call($)},this.ws.onerror=$=>{var d,W;console.error("WebSocket error:",$),(W=(d=this.callbacks).onError)==null||W.call(d,$.message||"Connection error"),x($)}})}disconnect(){if(this.ws&&(this.ws.close(),this.ws=null),this.pendingRequests){for(const[,{reject:l}]of this.pendingRequests.entries())l(new Error("Connection closed"));this.pendingRequests.clear()}this.sources.clear(),this.filtersFound.clear()}sendRequest(l,v={}){return new Promise((r,g)=>{if(!this.isConnected||!this.ws){console.warn("No connection to OBS"),g(new Error("No connection to OBS"));return}const x=this.generateMessageId().toString(),L={op:6,d:{requestType:l,requestId:x,requestData:v}};console.log("Sending OBS request: ".concat(l),v),this.pendingRequests.set(x,{resolve:r,reject:g}),this.ws.send(JSON.stringify(L)),setTimeout(()=>{this.pendingRequests&&this.pendingRequests.has(x)&&(this.pendingRequests.delete(x),g(new Error("Request ".concat(l," timed out"))))},1e4)})}handleMessage(l){switch(l.op){case 0:this.handleHello(l.d);break;case 2:this.handleIdentified();break;case 7:this.handleRequestResponse(l.d);break;case 5:this.handleEvent(l.d);break;default:console.log("Unknown OBS message: op=".concat(l.op))}}authenticate(l=""){return new Promise(v=>{this.password=l,this.authResolve=v})}async handleHello(l){console.log("Received OBS hello"),this.isConnected=!0;const v={op:1,d:{rpcVersion:1}};if(l.authentication&&this.password)try{const r=new TextEncoder,g=await crypto.subtle.digest("SHA-256",r.encode(this.password+l.authentication.salt)),x=Array.from(new Uint8Array(g)),L=btoa(String.fromCharCode(...x)),$=await crypto.subtle.digest("SHA-256",r.encode(L+l.authentication.challenge)),d=Array.from(new Uint8Array($)),W=btoa(String.fromCharCode(...d));v.d.authentication=W}catch(r){console.error("Authentication error:",r)}this.ws.send(JSON.stringify(v))}handleIdentified(){console.log("OBS authentication successful"),this.isAuthenticated=!0,this.authResolve&&(this.authResolve({success:!0}),this.authResolve=null)}handleRequestResponse(l){const{requestId:v,requestType:r,requestStatus:g,responseData:x}=l;if(console.log("Received response for ".concat(r,":"),{success:g.result,code:g.code,comment:g.comment}),!this.pendingRequests){console.warn("No pending requests map");return}const L=this.pendingRequests.get(v);if(!L){console.warn("No pending request found for ID: ".concat(v));return}this.pendingRequests.delete(v),g.result?(console.log("Request ".concat(r," successful"),x),L.resolve(x)):(console.error("Request ".concat(r," failed:"),g.comment),L.reject(new Error("".concat(r," failed: ").concat(g.comment))))}handleFilterListResponse(l){const v=l.sourceName,g=(l.filters||[]).find(x=>x.filterName.toLowerCase()===this.BLUR_FILTER_NAME.toLowerCase());g&&(this.foundFilters.set(v,{sourceName:v,filterName:g.filterName,enabled:g.filterEnabled}),console.log("Found reyohoho filter in source: ".concat(v))),this.checkSearchComplete()}checkSearchComplete(){setTimeout(()=>{var l,v;console.log("Search complete. Found ".concat(this.foundFilters.size," reyohoho filters")),(v=(l=this.callbacks).onFiltersFound)==null||v.call(l,Array.from(this.foundFilters.values()))},500)}handleEvent(l){console.log("OBS event: ".concat(l.eventType))}async testConnection(){try{console.log("Testing OBS connection...");const l=await this.sendRequest("GetVersion");return console.log("OBS connection test successful:",l),{success:!0,version:l}}catch(l){return console.error("OBS connection test failed:",l),{success:!1,error:l.message}}}async loadSourcesAndSearchFilters(){var l,v,r,g,x,L,$,d,W,X;try{console.log("Loading sources and searching for filters...");try{const B=await this.sendRequest("GetVersion");console.log("OBS version info:",B)}catch(B){console.warn("Could not get OBS version:",B)}console.log("Requesting scene list...");const M=await this.sendRequest("GetSceneList");if(console.log("Raw scenes response:",M),!M||!M.scenes){console.error("Invalid scenes response structure:",M),(v=(l=this.callbacks).onError)==null||v.call(l,"Invalid response from OBS - no scenes data");return}console.log("Found scenes:",M.scenes.length),console.log("Requesting input list...");const re=await this.sendRequest("GetInputList");if(console.log("Raw inputs response:",re),!re||!re.inputs){console.error("Invalid inputs response structure:",re),(g=(r=this.callbacks).onError)==null||g.call(r,"Invalid response from OBS - no inputs data");return}console.log("Found inputs:",re.inputs.length),this.sources.clear(),this.filtersFound.clear();for(const B of M.scenes)if(console.log("Checking scene: ".concat(B.sceneName," with ").concat(B.sceneItems?B.sceneItems.length:0," items")),B.sceneItems&&Array.isArray(B.sceneItems))for(const b of B.sceneItems)b.sourceName&&(this.sources.set(b.sourceName,{sceneName:B.sceneName,sourceId:b.sceneItemId,sourceName:b.sourceName}),await this.searchFiltersInSource(b.sourceName,B.sceneName));for(const B of re.inputs)console.log("Checking input: ".concat(B.inputName)),this.sources.has(B.inputName)||this.sources.set(B.inputName,{sceneName:"Direct Input",sourceId:null,sourceName:B.inputName}),await this.searchFiltersInSource(B.inputName,"Direct Input");const V=Array.from(this.filtersFound.values());console.log("Total filters found:",V.length),V.forEach(B=>{console.log("- ".concat(B.sourceName,": ").concat(B.filterName," (").concat(B.enabled?"enabled":"disabled",")"))}),(L=(x=this.callbacks).onFiltersFound)==null||L.call(x,V),(d=($=this.callbacks).onSourcesUpdated)==null||d.call($,Array.from(this.sources.values()))}catch(M){console.error("Error loading sources:",M),console.error("Error stack:",M.stack),(X=(W=this.callbacks).onError)==null||X.call(W,"Error loading sources: ".concat(M.message))}}async searchFiltersInSource(l,v){try{console.log("Searching filters in source: ".concat(l));const r=await this.sendRequest("GetSourceFilterList",{sourceName:l});console.log("Source ".concat(l," has ").concat(r.filters.length," filters"));for(const g of r.filters){console.log("  Filter: ".concat(g.filterName," (").concat(g.filterEnabled?"enabled":"disabled",")"));const x="".concat(l,"::").concat(g.filterName);this.filtersFound.set(x,{id:x,sourceName:l,sceneName:v,filterName:g.filterName,enabled:g.filterEnabled})}}catch(r){console.warn("Could not get filters for source ".concat(l,":"),r)}}async enableBlur(l){var r,g;if(!l){console.warn("No filter selected for blur");return}const v=this.filtersFound.get(l);if(!v){console.warn("Selected filter not found:",l);return}try{await this.sendRequest("SetSourceFilterEnabled",{sourceName:v.sourceName,filterName:v.filterName,filterEnabled:!0}),v.enabled=!0,console.log("Enabled blur filter: ".concat(v.sourceName,"::").concat(v.filterName))}catch(x){(g=(r=this.callbacks).onError)==null||g.call(r,"Error enabling filter: ".concat(x.message))}}async disableBlur(l){var r,g;if(!l){console.warn("No filter selected for blur");return}const v=this.filtersFound.get(l);if(!v){console.warn("Selected filter not found:",l);return}try{await this.sendRequest("SetSourceFilterEnabled",{sourceName:v.sourceName,filterName:v.filterName,filterEnabled:!1}),v.enabled=!1,console.log("Disabled blur filter: ".concat(v.sourceName,"::").concat(v.filterName))}catch(x){(g=(r=this.callbacks).onError)==null||g.call(r,"Error disabling filter: ".concat(x.message))}}async testBlur(l,v=2e3){if(!l){console.warn("No filter selected for test");return}await this.enableBlur(l),setTimeout(()=>{this.disableBlur(l)},v)}getFilterById(l){return this.filtersFound.get(l)}getAllFilters(){return Array.from(this.filtersFound.values())}}const Tn={class:"players-list"},$n={class:"source-modal"},An={key:0,class:"source-loading"},Mn={key:1,class:"source-error"},Bn={key:2,class:"source-empty"},Fn={key:3,class:"source-candidate-list"},Pn=["onClick"],Nn={class:"source-title"},On={class:"source-meta"},Rn=["src"],Ln={key:2,class:"controls"},_n={class:"main-controls"},Dn={class:"material-icons"},qn={class:"list-button-item"},Hn={class:"material-icons"},Wn={class:"list-button-item"},Vn={class:"material-icons"},zn={class:"list-button-item"},Un={class:"list-button-item"},Kn={class:"material-icons"},Gn={class:"list-button-item"},Yn={class:"material-icons"},jn={class:"tooltip-container","data-tooltip-container":"dimming"},Xn={class:"material-icons"},Jn={class:"tooltip-container","data-tooltip-container":"blur"},Zn={class:"tooltip-container","data-tooltip-container":"compressor"},Qn={class:"tooltip-container","data-tooltip-container":"mirror"},es={class:"tooltip-container","data-tooltip-container":"theater"},ts={class:"material-symbols-outlined"},os={class:"custom-tooltip","data-tooltip":"theater"},ns={class:"tooltip-container","data-tooltip-container":"pip"},ss={class:"tooltip-container","data-tooltip-container":"aspect_ratio"},is={class:"current-ratio"},ls=["onClick"],as={key:0,class:"tooltip-container","data-tooltip-container":"app_link"},rs={class:"custom-tooltip","data-tooltip":"app_link"},cs={key:1,class:"tooltip-container","data-tooltip-container":"mpv"},us={class:"custom-tooltip","data-tooltip":"mpv"},ds={key:2,class:"tooltip-container","data-tooltip-container":"copy_link"},vs={class:"custom-tooltip","data-tooltip":"copy_link"},ps={key:3,class:"tooltip-container","data-tooltip-container":"overlay"},ms={class:"material-icons"},fs={key:0,class:"desktop-list-buttons"},gs={class:"tooltip-container"},ys={class:"material-icons"},hs={class:"custom-tooltip"},bs={class:"tooltip-container"},ws={class:"material-icons"},ks={class:"custom-tooltip"},xs={class:"tooltip-container"},Ss={class:"custom-tooltip"},Cs={class:"tooltip-container"},Is={class:"material-icons"},Es={class:"custom-tooltip"},Ts={class:"tooltip-container"},$s={class:"material-icons"},As={class:"custom-tooltip"},Ms={__name:"PlayerComponent",props:{kpId:String,movieInfo:{type:Object,default:()=>({})}},emits:["update:selectedPlayer","update:movieInfo"],setup(D,{emit:l}){const v=co(),r=vn(),g=Qo(),x=en(),L=uo(),$=m(x.params.kp_id),d=D,W=l,X=m([]),M=m(null),re=m(!0),V=m(!1),B=m(!1),b=m(null),I=m(null),z=m(!1),E=m(!1),Ce=m([]),ne=m(!1),Z=m(""),j=m(""),He=m(null),mt=m(window.innerHeight*.9),mo=ae(()=>"".concat(mt.value,"px")),ft=ae(()=>v.isMobile),C=ae(()=>!!window.electronAPI),Ht=ae(()=>v.contentApiProvider==="kinobd"&&!String(d.kpId||"").startsWith("shiki")),T=m(null),gt=m(!1);let St=null;const Ee=m(null),fo=m(null),go=m(null),fe=m(null),je=m(!1),xe=m(!1),ge=m(null),Ct=m(null),yt=m(0),ue=m(null),Te=m(null),Se=m(null),We=m(null),Ve=m(null),$e=m(null),q=ae({get:()=>r.videoOverlayEnabled2,set:t=>r.updateVideoOverlay(t)}),F=ae({get:()=>r.overlaySettings,set:t=>r.updateOverlaySettings(t)}),Wt=m(0),Vt=m(0),ze=m([]),st=m(!1);let Ne=null;const f=m(null),Xe=m(null),Ae=m(!1),J=m(null),Me=m(!1),zt=m([]),Je=m([]),ve=ae({get:()=>r.obsSettings,set:t=>r.updateObsSettings(t)}),It=t=>{const e=document.querySelector('[data-tooltip-container="'.concat(t,'"]')),o=document.querySelector('[data-tooltip="'.concat(t,'"]'));if(!e||!o)return;const s=e.getBoundingClientRect(),i=o.getBoundingClientRect(),p=window.innerHeight;s.bottom+i.height>p?(o.style.top="auto",o.style.bottom="100%",o.style.marginTop="0",o.style.marginBottom="12px",o.style.transform="translateX(-50%)"):(o.style.top="100%",o.style.bottom="auto",o.style.marginTop="12px",o.style.marginBottom="0",o.style.transform="translateX(-50%)")},le=t=>{T.value=t,gt.value=!1,clearTimeout(St),_t(()=>{It(t)})},Et=()=>{gt.value||(St=setTimeout(()=>{T.value=null},300))},Tt=()=>{gt.value=!0,clearTimeout(St)},ht=()=>{gt.value=!1,T.value=null},Oe=ae({get:()=>r.aspectRatio,set:t=>r.updateAspectRatio(t)}),it=ae({get:()=>r.isCentered,set:t=>r.updateCentering(t)}),yo=ae(()=>{var t,e,o,s,i,p,R,h,a,y;return((e=(t=d.movieInfo)==null?void 0:t.lists)==null?void 0:e.isFavorite)||((s=(o=d.movieInfo)==null?void 0:o.lists)==null?void 0:s.isWatching)||((p=(i=d.movieInfo)==null?void 0:i.lists)==null?void 0:p.isLater)||((h=(R=d.movieInfo)==null?void 0:R.lists)==null?void 0:h.isCompleted)||((y=(a=d.movieInfo)==null?void 0:a.lists)==null?void 0:y.isAbandoned)}),Ut=ae(()=>r.preferredPlayer),ho=m(0),bt=t=>t.toUpperCase(),Kt=t=>{if(X.value=Object.entries(t||{}).map(([e,o])=>({key:e.toUpperCase(),...o})),X.value.length!==0){if(Ut.value){const e=bt(Ut.value),o=X.value.find(s=>bt(s.key)===e);M.value=o||X.value[0]}else M.value=X.value[0];W("update:selectedPlayer",M.value)}},$t=()=>{if(V.value||!I.value)return;const[t,e]=Oe.value.split(":").map(Number);mt.value=window.innerHeight*.9,ho.value=Math.min(I.value.clientWidth*(e/t),mt.value)},bo=ae(()=>{if(V.value)return{};const[t,e]=Oe.value.split(":").map(Number),o=mt.value*(t/e);return{width:"100%",maxWidth:"".concat(o,"px"),maxHeight:mo.value,margin:"0 auto",overflow:"hidden"}}),wo=ae(()=>{const[t,e]=Oe.value.split(":").map(Number);return{position:"relative",width:"100%",paddingTop:"".concat(e/t*100,"%")}}),lt=()=>{I.value&&setTimeout(()=>{_t(()=>{I.value.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})},500)},ko=async()=>{var t;try{j.value="",He.value=null;let e;if(d.kpId.startsWith("shiki")){const o=d.kpId.replace("shiki","");e=await nn(o)}else{const o=((t=r.kinobdSourceByKpId)==null?void 0:t[String(d.kpId)])||null;e=await sn(d.kpId,{mode:"kp_id",usePlayerData:!0,forceInid:Ht.value?o:null})}Kt(e)}catch(e){const{message:o,code:s}=io(e);j.value=o,He.value=s,console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–ª–µ–µ—Ä–æ–≤:",e)}},xo=()=>{z.value=!0},Gt=()=>{z.value=!1},So=async()=>{var t,e,o,s;E.value=!0,Z.value="",ne.value=!0;try{const i=((t=d.movieInfo)==null?void 0:t.title)||((e=d.movieInfo)==null?void 0:e.name_ru)||((o=d.movieInfo)==null?void 0:o.name_en)||((s=d.movieInfo)==null?void 0:s.name_original)||d.kpId;let p=[];i&&(p=await lo(i,{type:"title",page:1})),!p.length&&d.kpId&&(p=await lo(d.kpId,{type:"kp_id",page:1})),Ce.value=p}catch(i){Z.value="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤",console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ KinoBD:",i)}finally{ne.value=!1}},At=()=>{E.value=!1},Co=async t=>{if(t!=null&&t.id){ne.value=!0,Z.value="";try{const e=await ln(t.id,{playerUrl:t.iframe});Kt(e),r.setKinoBdSource(d.kpId,t.id),At()}catch(e){Z.value="–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫",console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ KinoBD:",e)}finally{ne.value=!1}}},Io=()=>{try{return ue.value||(ue.value=new(window.AudioContext||window.webkitAudioContext)),Te.value||(Te.value=ue.value.createDynamicsCompressor(),Te.value.threshold.value=-50,Te.value.knee.value=40,Te.value.ratio.value=12,Te.value.attack.value=0,Te.value.release.value=.25,We.value=ue.value.createGain(),Ve.value=ue.value.createGain(),We.value.gain.value=0,Ve.value.gain.value=1,Te.value.connect(We.value),We.value.connect(ue.value.destination),Ve.value.connect(ue.value.destination)),!0}catch(t){return console.log("Error initializing audio context:",t),!1}},Eo=async t=>{try{if(!ue.value||$e.value===t)return!0;const e=b.value,o=(e==null?void 0:e.src)||"";if(o.includes("videoframe")||o.includes("kinoserial.net")||o.includes("allarknow"))return console.log("Player detected as unsupported for compressor:",o),$e.value=t,Se.value=null,xe.value=!1,C.value&&window.electronAPI.showToast("–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —ç—Ç–∏–º –ø–ª–µ–µ—Ä–æ–º"),!1;if(Se.value)try{Se.value.disconnect()}catch(i){}const s=async(i=0)=>{i>0&&await new Promise(p=>setTimeout(p,i));try{return Se.value=ue.value.createMediaElementSource(t),$e.value=t,Se.value.connect(Te.value),Se.value.connect(Ve.value),console.log("Video audio setup completed (attempt with ".concat(i,"ms delay)")),!0}catch(p){if(p.name==="InvalidStateError"&&p.message.includes("already connected"))return console.log("MediaElementSource already connected (".concat(i,"ms delay attempt)")),!1;throw p}};return await s(0)||await s(100)||await s(300)||await s(800)?!0:(console.log("Video element has internal audio processing, compressor not available for this player"),$e.value=t,Se.value=null,xe.value=!1,C.value&&window.electronAPI.showToast("–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —ç—Ç–∏–º –ø–ª–µ–µ—Ä–æ–º"),!1)}catch(e){return console.log("Error setting up video audio:",e),!1}},Mt=async t=>{if(b.value)try{const e=b.value,o=e.contentDocument||e.contentWindow.document;if(!o)return;const s=o.querySelectorAll("video");if(s.length===0)return;const i=s[0];if(!Io())return;if(!await Eo(i)||!Se.value){console.log("Compressor not available for this player");return}t&&!xe.value?(We.value.gain.setValueAtTime(1,ue.value.currentTime),Ve.value.gain.setValueAtTime(0,ue.value.currentTime),xe.value=!0,C.value&&window.electronAPI.showToast("–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä –≤–∫–ª—é—á—ë–Ω"),console.log("Compressor enabled")):!t&&xe.value&&(We.value.gain.setValueAtTime(0,ue.value.currentTime),Ve.value.gain.setValueAtTime(1,ue.value.currentTime),xe.value=!1,C.value&&window.electronAPI.showToast("–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä –æ—Ç–∫–ª—é—á—ë–Ω"),console.log("Compressor disabled"))}catch(e){console.log("Compressor error:",e),C.value&&window.electronAPI.showToast("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä–∞")}},To=()=>{if(b.value)try{const t=b.value,e=t.contentDocument||t.contentWindow.document;if(!e)return;const o=e.querySelectorAll("video");if(o.length>0){const s=o[0];s.style.filter.includes("blur")||(s.style.filter="blur(50px)")}else t.style.filter.includes("blur")||(t.style.filter="blur(50px)")}catch(t){console.log("Error enabling blur:",t)}},$o=()=>{if(b.value)try{const t=b.value,e=t.contentDocument||t.contentWindow.document;if(!e)return;const o=e.querySelectorAll("video");if(o.length>0){const s=o[0];s.style.filter.includes("blur")&&(s.style.filter="")}else t.style.filter.includes("blur")&&(t.style.filter="")}catch(t){console.log("Error disabling blur:",t)}},Ao=()=>{if(C.value)try{const t=b.value,e=t.contentDocument||t.contentWindow.document;if(!e)return;const o=e.querySelectorAll("video");if(o.length>0){const s=o[0];s.style.filter.includes("blur")?s.style.filter="":s.style.filter="blur(50px)"}else t.style.filter.includes("blur")?t.style.filter="":t.style.filter="blur(50px)"}catch(t){console.log("Error toggling blur:",t)}else ot("–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ReYohoho Desktop"),window.open("https://t.me/ReYohoho/126","_blank")},Yt=()=>{C.value?(Ue.value=!Ue.value,Mt(Ue.value)):(ot("–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ReYohoho Desktop"),window.open("https://t.me/ReYohoho/126","_blank"))},jt=()=>{C.value?(Ze.value=!Ze.value,Bo(Ze.value)):(ot("–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ReYohoho Desktop"),window.open("https://t.me/ReYohoho/126","_blank"))},wt=()=>{V.value=!V.value,V.value?(window.addEventListener("mousemove",Bt),document.addEventListener("keydown",Ft),document.body.classList.add("no-scroll")):(window.removeEventListener("mousemove",Bt),document.removeEventListener("keydown",Ft),document.body.classList.remove("no-scroll")),B.value=V.value,_t(()=>{lt(),b.value&&b.value.focus()})},Xt=m(null),Bt=()=>{Xt.value=setTimeout(()=>{clearTimeout(Xt.value),B.value=!1},4e3),B.value=!0},kt=ae(()=>v.dimmingEnabled),Mo=()=>{V.value||v.toggleDimming()},Ue=ae({get:()=>r.compressorEnabled,set:t=>r.updateCompressor(t)}),Ze=ae({get:()=>r.mirrorEnabled,set:t=>r.updateMirror(t)}),Bo=t=>{if(b.value)try{const e=b.value,o=e.contentDocument||e.contentWindow.document;if(!o)return;const s=o.querySelectorAll("video");if(s.length>0&&(s.forEach(i=>{t?i.style.transform="scaleX(-1)":i.style.transform="scaleX(1)"}),je.value=t,C.value)){const i=t?"–ó–µ—Ä–∫–∞–ª–æ –≤–∫–ª—é—á–µ–Ω–æ":"–ó–µ—Ä–∫–∞–ª–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ";window.electronAPI.showToast(i)}}catch(e){}},Fo=()=>{fe.value&&clearInterval(fe.value),fe.value=setInterval(()=>{if(b.value)try{const t=b.value,e=t.contentDocument||t.contentWindow.document;if(!e)return;const o=e.querySelectorAll("video");if(o.length>0){const s=o[0],p=s.style.transform==="scaleX(-1)";Ze.value&&!p?(s.style.transform="scaleX(-1)",je.value=!0):!Ze.value&&p&&(s.style.transform="scaleX(1)",je.value=!1),$e.value!==s?($e.value=null,xe.value=!1,Ue.value&&setTimeout(()=>{Mt(!0)},500)):Ue.value!==xe.value&&Se.value&&(console.log("Compressor state mismatch, reapplying"),Mt(Ue.value))}}catch(t){}},1e3)},Po=(t=!1)=>{if(!C.value)return;ge.value&&clearInterval(ge.value);let e=!1,o=[];function s(){var i;if(o=[],window.selectedNudityTimings&&Array.isArray(window.selectedNudityTimings)&&((i=d.movieInfo)!=null&&i.nudity_timings)){for(const p of d.movieInfo.nudity_timings)if(window.selectedNudityTimings.includes(p.id)){const R=ao(p.timing_text);R&&R.length>0&&o.push(...R)}}}s(),ge.value=setInterval(()=>{var i,p,R;if(b.value){s();try{const h=b.value,a=h.contentDocument||h.contentWindow.document;if(!a)return;const y=a.querySelectorAll("video");if(y.length>0){const A=y[0];if(Wt.value=A.currentTime||0,Vt.value=A.duration||0,C.value&&q.value&&!f.value&&!Ae.value&&Date.now()-(window.iframeLoadTime||0)>=100)try{Qe(a,A)}catch(Q){console.log("Error creating overlay:",Q),Ae.value=!1}if(C.value&&!q.value&&f.value&&setTimeout(()=>{!q.value&&f.value&&Re()},100),C.value&&((i=d.movieInfo)!=null&&i.nudity_timings)){const U=A.currentTime,Q=[],pe=[];if(window.overlayNudityTimings&&Array.isArray(window.overlayNudityTimings)&&window.overlayNudityTimings.length>0){for(const K of d.movieInfo.nudity_timings)if(window.overlayNudityTimings.includes(K.id)){const N=ao(K.timing_text);if(N&&N.length>0){const H=[];for(const[de,we]of N){let se="normal";U>=de&&U<=we?(se="active",pe.push(K.id)):de>U&&de-U<=5&&(se="upcoming"),H.push({text:"[".concat(tt(de),"-").concat(tt(we),"]"),status:se})}Q.push({id:K.id,intervals:H})}}}ze.value=Q,st.value=pe.length>0||Q.some(K=>K.intervals.some(N=>N.status==="upcoming"))}if(C.value&&f.value&&q.value&&oo(),!A.paused){const U=A.currentTime,Q=A.duration,pe=Q>0?U/Q*100:0;if(t&&(console.log("Video position: ".concat(U.toFixed(2),"s / ").concat(Q.toFixed(2),"s (").concat(pe.toFixed(1),"%)")),o.length>0)){const N=o.map(([H,de])=>"".concat(tt(H)," - ").concat(tt(de))).join(", ");console.log("Active blur intervals: [".concat(N,"]"))}let K=!1;for(const[N,H]of o)if(U>=N&&U<=H){K=!0;break}ve.value.enabled&&Me.value&&ve.value.selectedFilterId?K&&!e?((p=J.value)==null||p.enableBlur(ve.value.selectedFilterId),e=!0,console.log("OBS Blur applied at",U.toFixed(2),"seconds")):!K&&e&&((R=J.value)==null||R.disableBlur(ve.value.selectedFilterId),e=!1,console.log("OBS Blur removed at",U.toFixed(2),"seconds")):K&&!e&&C.value?(To(),e=!0,console.log("Blur applied at",U.toFixed(2),"seconds")):!K&&e&&!ve.value.enabled&&($o(),e=!1,console.log("Blur removed at",U.toFixed(2),"seconds"))}}}catch(h){console.log("Error monitoring video position:",h)}}},100)},No=()=>{re.value=!1,window.iframeLoadTime=Date.now(),Fo(),Po(),C.value&&q.value&&!f.value&&setTimeout(()=>{try{const t=b.value,e=t.contentDocument||t.contentWindow.document;if(e){const o=e.querySelector("video");o&&Qe(e,o)}}catch(t){console.log("Error creating overlay on iframe load:",t),Ae.value=!1}},100)},Ft=t=>{(t.key==="Escape"&&V.value||t.altKey&&t.keyCode===84)&&wt()},Jt=t=>{Oe.value=t,setTimeout(()=>{it.value&&lt()},310)},Oo=()=>{const t="reyohoho://#".concat($.value);try{window.location.href=t}catch(e){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Å—ã–ª–∫–∏:",e)}},Ro=t=>{if(!t)return"";const o=[t.hls,t.stream,t.url,t.file,t.src].filter(p=>typeof p=="string"&&p).find(p=>/\.m3u8(\?|$)/i.test(p)||/manifest/i.test(p)||/\/hls\//i.test(p));if(o)return o;const s=t.raw_data;if(s&&typeof s=="object"){const p=[s],R=new Set;for(;p.length;){const h=p.shift();if(!(!h||typeof h!="object")&&!R.has(h)){R.add(h);for(const a of Object.values(h))if(a)if(typeof a=="string"){if(/^https?:\/\//i.test(a)&&(/\.m3u8(\?|$)/i.test(a)||/manifest/i.test(a)||/\/hls\//i.test(a)))return a}else typeof a=="object"&&p.push(a)}}}const i=String(t.iframe||"");if(!i)return"";try{const p=new URL(i),R=[];p.searchParams.forEach(h=>R.push(h));for(const h of R)if(/^https?:\/\//i.test(h)&&/\.m3u8(\?|$)/i.test(h))return h}catch(p){return""}return""},Zt=async t=>{if(!t)return!1;try{return await navigator.clipboard.writeText(t),!0}catch(e){return!1}},Lo=async()=>{const t=M.value;if(!t)return;const o=Ro(t)||String(t.iframe||"");if(!o){Ee.value.showNotification("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è mpv");return}const s=(()=>{try{const h=new URL(String(t.iframe||""));return"".concat(h.origin,"/")}catch(h){return""}})(),i=s?'mpv --referrer="'.concat(s,'" "').concat(o,'"'):'mpv "'.concat(o,'"');if(await Zt(i)){Ee.value.showNotification("–ö–æ–º–∞–Ω–¥–∞ mpv —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞");return}if(await Zt(o)){Ee.value.showNotification("–°—Å—ã–ª–∫–∞ –¥–ª—è mpv —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞");return}Ee.value.showNotification("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è mpv")},_o=()=>{const t=window.location.href;navigator.clipboard.writeText(t).then(()=>{}),Ee.value.showNotification("–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∏–ª—å–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞")};function Qt(t){return t.replace(/KODIK>/,"Kodik - ").replace(/VEOVEO>/,"VeoVeo - ").trim()}const Do=()=>{try{Se.value&&(Se.value.disconnect(),Se.value=null),ue.value&&(ue.value.close(),ue.value=null),Te.value=null,We.value=null,Ve.value=null,$e.value=null,xe.value=!1}catch(t){console.log("Error cleaning up audio context:",t)}},qo=t=>{var e;if(((e=M.value)==null?void 0:e.key)===t.key){Gt();return}M.value=t,re.value=!0,je.value=!1,xe.value=!1,$e.value=null,f.value&&Re(),fe.value&&(clearInterval(fe.value),fe.value=null),ge.value&&(clearInterval(ge.value),ge.value=null),t.key.toLowerCase().includes("torrents")||r.updatePreferredPlayer(bt(t.key)),W("update:selectedPlayer",t)};et(M,t=>{t&&(re.value=!0,je.value=!1,xe.value=!1,$e.value=null,f.value&&Re(),fe.value&&(clearInterval(fe.value),fe.value=null),ge.value&&(clearInterval(ge.value),ge.value=null),t.key.toLowerCase().includes("torrents")||r.updatePreferredPlayer(bt(t.key)),W("update:selectedPlayer",t))}),et(()=>x.params.kp_id,async t=>{t&&t!==$.value&&($.value=t,je.value=!1,xe.value=!1,$e.value=null,f.value&&Re(),fe.value&&(clearInterval(fe.value),fe.value=null),ge.value&&(clearInterval(ge.value),ge.value=null),yt.value=0,it.value&&lt())},{immediate:!0}),et(q,t=>{if(C.value)if(t&&!f.value){const e=()=>{if(b.value)try{const o=b.value,s=o.contentDocument||o.contentWindow.document;if(s){const i=s.querySelector("video");if(i){const p=Date.now()-(window.iframeLoadTime||0);p>=100?Qe(s,i):setTimeout(e,100-p)}}}catch(o){console.log("Error creating overlay via watcher:",o),Ae.value=!1}};e()}else!t&&f.value&&Re()}),et(ze,(t,e)=>{if(!C.value)return;const o=e&&e.length>0,s=t&&t.length>0;!o&&s&&(q.value||(q.value=!0,window.electronAPI&&window.electronAPI.showToast("–û–≤–µ—Ä–ª–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á—ë–Ω - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∏–Ω–≥–∏")))},{deep:!0}),et(()=>ve.value.enabled,t=>{t&&!Me.value?Nt():!t&&Me.value&&to()}),et(F,(t,e)=>{!C.value||!q.value||(e&&t.showBackground!==e.showBackground?f.value&&(Re(),setTimeout(()=>{if(b.value&&q.value)try{const o=b.value,s=o.contentDocument||o.contentWindow.document;if(s){const i=s.querySelector("video");i&&Qe(s,i)}}catch(o){console.log("Error recreating overlay:",o)}},100)):f.value&&oo())},{deep:!0});const xt=["16:9","12:5","4:3"],Ho=()=>{const e=(xt.indexOf(Oe.value)+1)%xt.length;Jt(xt[e])},Wo=t=>{var o,s,i,p,R,h,a,y,A,U,Q,pe,K;return(K={[Y.FAVORITE]:((s=(o=d.movieInfo)==null?void 0:o.lists)==null?void 0:s.isFavorite)||!1,[Y.HISTORY]:((p=(i=d.movieInfo)==null?void 0:i.lists)==null?void 0:p.isHistory)||!1,[Y.LATER]:((h=(R=d.movieInfo)==null?void 0:R.lists)==null?void 0:h.isLater)||!1,[Y.COMPLETED]:((y=(a=d.movieInfo)==null?void 0:a.lists)==null?void 0:y.isCompleted)||!1,[Y.ABANDONED]:((U=(A=d.movieInfo)==null?void 0:A.lists)==null?void 0:U.isAbandoned)||!1,[Y.WATCHING]:((pe=(Q=d.movieInfo)==null?void 0:Q.lists)==null?void 0:pe.isWatching)||!1}[t])!=null?K:!1},Ie=async t=>{if(!g.token){Ee.value.showNotification('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ <a class="auth-link">–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</a>',5e3,{onClick:Vo});return}try{const e={[Y.FAVORITE]:"–∏–∑–±—Ä–∞–Ω–Ω–æ–µ",[Y.HISTORY]:"–∏—Å—Ç–æ—Ä–∏—é",[Y.LATER]:'—Å–ø–∏—Å–æ–∫ "–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∑–∂–µ"',[Y.COMPLETED]:'—Å–ø–∏—Å–æ–∫ "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ"',[Y.ABANDONED]:'—Å–ø–∏—Å–æ–∫ "–ë—Ä–æ—à–µ–Ω–æ"',[Y.WATCHING]:'—Å–ø–∏—Å–æ–∫ "–°–º–æ—Ç—Ä—é"'};Wo(t)?(await an($.value,t),Ee.value.showNotification("–£–¥–∞–ª–µ–Ω–æ –∏–∑ ".concat(e[t]))):(await rn($.value,t),Ee.value.showNotification("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ ".concat(e[t])))}catch(e){const{message:o,code:s}=io(e);Ee.value.showNotification("".concat(o," ").concat(s))}W("update:movieInfo")},Vo=()=>{L.push("/login")},Pt=ae(()=>r.showFavoriteTooltip),zo=()=>{L.push("/settings"),ht()},Uo=async()=>{if(!C.value){ot("–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ReYohoho Desktop"),window.open("https://t.me/ReYohoho/126","_blank");return}if(b.value)try{const t=b.value,e=t.contentDocument||t.contentWindow.document;if(!e)return;const o=e.querySelector("video");if(!o)return;document.pictureInPictureElement?await document.exitPictureInPicture():document.pictureInPictureEnabled?await o.requestPictureInPicture():ot('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º "–ö–∞—Ä—Ç–∏–Ω–∫–∞ –≤ –∫–∞—Ä—Ç–∏–Ω–∫–µ"')}catch(t){console.error("Error toggling PiP:",t),ot('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º "–ö–∞—Ä—Ç–∏–Ω–∫–∞ –≤ –∫–∞—Ä—Ç–∏–Ω–∫–µ"')}},Ko=()=>{if(q.value=!q.value,!q.value)Re();else{const t=()=>{if(!f.value&&b.value)try{const e=b.value,o=e.contentDocument||e.contentWindow.document;if(o){const s=o.querySelector("video");if(s){const i=Date.now()-(window.iframeLoadTime||0);i>=100?Qe(o,s):setTimeout(t,100-i)}}}catch(e){console.log("Error creating overlay:",e),Ae.value=!1}};t()}},eo=()=>{J.value&&J.value.disconnect(),J.value=new En,J.value.setCallbacks({onConnect:()=>{Me.value=!0,r.setObsConnected(!0),C.value&&window.electronAPI&&window.electronAPI.showToast("–ü–æ–¥–∫–ª—é—á–µ–Ω –∫ OBS WebSocket")},onDisconnect:()=>{Me.value=!1,r.setObsConnected(!1),zt.value=[],Je.value=[]},onSourcesUpdated:t=>{zt.value=t,window.obsSources=t},onFiltersFound:t=>{Je.value=t,window.obsFiltersFound=t,r.updateObsSettings({filtersFound:t})},onError:t=>{console.error("OBS WebSocket error:",t),C.value&&window.electronAPI&&window.electronAPI.showToast("–û—à–∏–±–∫–∞ OBS: ".concat(t))}})},Nt=async()=>{J.value||eo(),await J.value.connect(ve.value.host,ve.value.port,ve.value.password)},to=()=>{J.value&&J.value.disconnect()},Go=t=>{J.value&&Me.value&&t?J.value.testBlur(t):C.value&&window.electronAPI&&window.electronAPI.showToast("–§–∏–ª—å—Ç—Ä –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ OBS")},Yo=()=>{J.value&&Me.value&&J.value.loadSourcesAndSearchFilters()},jo=()=>Je.value,Xo=()=>{try{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen();const t=b.value;if(t){const e=t.contentDocument||t.contentWindow.document;if(e){e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen();const o=e.querySelector("video");o&&(o.webkitExitFullscreen?o.webkitExitFullscreen():o.exitFullscreen&&o.exitFullscreen())}}}catch(t){console.log("Error exiting fullscreen:",t)}},Jo=()=>{if(!C.value)return;const t=b.value,e=t.contentDocument||t.contentWindow.document;if(!e||e.getElementById("overlay-settings-modal"))return;const o=F.value,s=e.createElement("div");s.id="overlay-settings-modal",s.style.cssText="\n    position: fixed !important;\n    top: 0 !important;\n    left: 0 !important;\n    width: 100% !important;\n    height: 100% !important;\n    background: rgba(0, 0, 0, 0.8) !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    z-index: 9999 !important;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n  ";const i=e.createElement("div");i.style.cssText="\n    background: rgba(30, 30, 30, 0.95) !important;\n    backdrop-filter: blur(20px) !important;\n    border-radius: 16px !important;\n    padding: 32px !important;\n    max-width: 400px !important;\n    width: 90% !important;\n    border: 1px solid rgba(255, 255, 255, 0.1) !important;\n    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5) !important;\n  ",i.innerHTML='\n    <h3 style="color: #ff6b35; margin: 0 0 24px 0; font-size: 20px; font-weight: 600; text-align: center;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–≤–µ—Ä–ª–µ—è</h3>\n    \n    <div style="display: flex; flex-direction: column; gap: 16px;">\n      <label style="display: flex; align-items: center; gap: 12px; color: white; cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(255, 255, 255, 0.05);">\n        <input type="checkbox" id="showTitle" '.concat(o.showTitle?"checked":"",' style="width: 18px; height: 18px; accent-color: #ff6b35;">\n        <span style="font-size: 16px;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</span>\n      </label>\n      \n      <label style="display: flex; align-items: center; gap: 12px; color: white; cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(255, 255, 255, 0.05);">\n        <input type="checkbox" id="showDuration" ').concat(o.showDuration2?"checked":"",' style="width: 18px; height: 18px; accent-color: #ff6b35;">\n        <span style="font-size: 16px;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span>\n      </label>\n      \n      <label style="display: flex; align-items: center; gap: 12px; color: white; cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(255, 255, 255, 0.05);">\n        <input type="checkbox" id="showBackground" ').concat(o.showBackground?"checked":"",' style="width: 18px; height: 18px; accent-color: #ff6b35;">\n        <span style="font-size: 16px;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞—Ç–µ–º–Ω–µ–Ω–Ω—ã–π —Ñ–æ–Ω</span>\n      </label>\n      \n      <label style="display: flex; align-items: center; gap: 12px; color: white; cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(255, 255, 255, 0.05);">\n        <input type="checkbox" id="showTimingsOnMouseMove" ').concat(o.showTimingsOnMouseMove?"checked":"",' style="width: 18px; height: 18px; accent-color: #ff6b35;">\n        <span style="font-size: 16px;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–∞–π–º–∏–Ω–≥–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –º—ã—à–∫–∏</span>\n      </label>\n      \n      <label style="display: flex; align-items: center; gap: 12px; color: white; cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(255, 255, 255, 0.05);">\n        <input type="checkbox" id="highlightTimings" ').concat(o.highlightTimings?"checked":"",' style="width: 18px; height: 18px; accent-color: #ff6b35;">\n        <span style="font-size: 16px;">–ü–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å –±–ª–∏–∑–∫–∏–µ –∏ —Ç–µ–∫—É—â–∏–µ —Ç–∞–π–º–∏–Ω–≥–∏</span>\n      </label>\n\n    </div>\n    \n    <div style="display: flex; gap: 12px; margin-top: 24px; justify-content: center;">\n      <button id="saveSettings" style="background: #ff6b35; color: white; border: none; border-radius: 8px; padding: 10px 20px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.3s ease;">\n        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å\n      </button>\n      <button id="cancelSettings" style="background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.8); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; padding: 10px 16px; cursor: pointer; font-size: 14px; transition: all 0.3s ease;">\n        –û—Ç–º–µ–Ω–∞\n      </button>\n    </div>\n  '),["click","mousedown","mouseup","mousemove","wheel","contextmenu"].forEach(a=>{i.addEventListener(a,y=>{y.stopPropagation(),y.stopImmediatePropagation()})}),s.appendChild(i),s.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),a.target===s&&s.remove()}),["mousedown","mouseup","mousemove","wheel","contextmenu"].forEach(a=>{s.addEventListener(a,y=>{y.preventDefault(),y.stopPropagation(),y.stopImmediatePropagation()})}),i.querySelector("#saveSettings").addEventListener("click",a=>{var A;a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();const y={showTitle:i.querySelector("#showTitle").checked,showDuration2:i.querySelector("#showDuration").checked,showBackground:i.querySelector("#showBackground").checked,showTimingsOnMouseMove:i.querySelector("#showTimingsOnMouseMove").checked,highlightTimings:i.querySelector("#highlightTimings").checked};F.value=y,(A=window.electronAPI)==null||A.showToast("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–≤–µ—Ä–ª–µ—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"),s.remove()}),i.querySelector("#cancelSettings").addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),s.remove()}),i.querySelectorAll("button").forEach(a=>{a.addEventListener("mouseenter",y=>{y.preventDefault(),y.stopPropagation(),y.stopImmediatePropagation(),a.id==="saveSettings"?(a.style.background="#e55a2b",a.style.transform="translateY(-1px)"):a.style.background="rgba(255, 255, 255, 0.15)"}),a.addEventListener("mouseleave",y=>{y.preventDefault(),y.stopPropagation(),y.stopImmediatePropagation(),a.id==="saveSettings"?(a.style.background="#ff6b35",a.style.transform="translateY(0)"):a.style.background="rgba(255, 255, 255, 0.1)"}),["mousedown","mouseup","mousemove","wheel","contextmenu"].forEach(y=>{a.addEventListener(y,A=>{A.preventDefault(),A.stopPropagation(),A.stopImmediatePropagation()})})});const R=i.querySelectorAll('input[type="checkbox"]'),h=i.querySelectorAll("label");R.forEach(a=>{["click","mousedown","mouseup","mousemove","wheel","contextmenu"].forEach(y=>{a.addEventListener(y,A=>{y!=="click"?(A.preventDefault(),A.stopPropagation(),A.stopImmediatePropagation()):A.stopPropagation()})})}),h.forEach(a=>{["mousedown","mouseup","mousemove","wheel","contextmenu"].forEach(y=>{a.addEventListener(y,A=>{A.preventDefault(),A.stopPropagation(),A.stopImmediatePropagation()})})}),e.body.appendChild(s)},Qe=(t,e)=>{if(!q.value||f.value||Ae.value)return;Ae.value=!0;const o=t.createElement("div");o.id="reyohoho-video-overlay";let s=()=>{o.style.cssText="\n      position: absolute !important;\n      top: 0 !important;\n      left: 0 !important;\n      width: 100% !important;\n      height: 100% !important;\n      pointer-events: none !important;\n      z-index: 999999999 !important;\n      display: flex !important;\n      flex-direction: column !important;\n      justify-content: space-between !important;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n      visibility: visible !important;\n      opacity: 1 !important;\n    "};const i=t.createElement("div");i.style.cssText="\n    color: white !important;\n    padding: 20px !important;\n    text-align: left !important;\n    pointer-events: none !important;\n  ";const p=t.createElement("div"),R=F.value.showBackground?"rgba(0, 0, 0, 0.7)":"transparent",h=F.value.showBackground?"blur(10px)":"none",a=F.value.showBackground?"fit-content":"auto",y=F.value.fontSize||18;p.style.cssText="\n    font-size: ".concat(y+2,"px !important;\n    font-weight: 600 !important;\n    margin-bottom: 8px !important;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8) !important;\n    line-height: 1.2 !important;\n    padding: 8px 12px !important;\n    border-radius: 6px !important;\n    display: inline-block !important;\n    color: rgba(255, 255, 255, 0.6) !important;\n    background: ").concat(R," !important;\n    backdrop-filter: ").concat(h," !important;\n    width: ").concat(a," !important;\n  ");const A=t.createElement("div"),U=F.value.showBackground?"rgba(0, 0, 0, 0.7)":"transparent",Q=F.value.showBackground?"blur(10px)":"none",pe=F.value.showBackground?"6px":"0",K=F.value.showBackground?"inline-flex":"flex",N=F.value.showBackground?"fit-content":"auto";A.style.cssText="\n    font-size: ".concat(y,"px !important;\n    font-weight: 500 !important;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8) !important;\n    display: ").concat(K," !important;\n    align-items: center !important;\n    gap: 8px !important;\n    flex-wrap: wrap !important;\n    color: rgba(255, 255, 255, 0.6) !important;\n    margin-left: 12px !important;\n    background: ").concat(U," !important;\n    backdrop-filter: ").concat(Q," !important;\n    border-radius: ").concat(pe," !important;\n    width: ").concat(N," !important;\n  ");const H=t.createElement("div"),de=F.value.showBackground?"rgba(0, 0, 0, 0.7)":"transparent",we=F.value.showBackground?"blur(10px)":"none";H.style.cssText="\n    position: absolute !important;\n    top: 20px !important;\n    right: 110px !important;\n    background: ".concat(de," !important;\n    backdrop-filter: ").concat(we," !important;\n    border-radius: 12px !important;\n    padding: 16px !important;\n    width: fit-content !important;\n    max-width: 800px !important;\n    pointer-events: none !important;\n    display: none !important;\n    transition: opacity 0.3s ease, visibility 0.3s ease !important;\n    opacity: 0 !important;\n    visibility: hidden !important;\n  ");const se=t.createElement("div");se.style.cssText="\n    font-size: ".concat(y-4,"px !important;\n    color: rgba(255, 255, 255, 0.6) !important;\n    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8) !important;\n    line-height: 1.4 !important;\n    word-wrap: break-word !important;\n  ");const G=t.createElement("div");G.style.cssText="\n    position: absolute !important;\n    top: 20px !important;\n    right: 20px !important;\n    display: flex !important;\n    gap: 8px !important;\n    pointer-events: all !important;\n  ";const ce=t.createElement("button");ce.style.cssText="\n    background: rgba(0, 0, 0, 0.8) !important;\n    backdrop-filter: blur(10px) !important;\n    color: white !important;\n    border: 1px solid rgba(255, 255, 255, 0.2) !important;\n    border-radius: 50% !important;\n    width: 40px !important;\n    height: 40px !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    cursor: pointer !important;\n    transition: all 0.3s ease !important;\n    font-size: 18px !important;\n  ",ce.innerHTML="‚öôÔ∏è",ce.title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–≤–µ—Ä–ª–µ—è";const ke=t.createElement("button");ke.style.cssText="\n    background: rgba(0, 0, 0, 0.8) !important;\n    backdrop-filter: blur(10px) !important;\n    color: white !important;\n    border: 1px solid rgba(255, 255, 255, 0.2) !important;\n    border-radius: 50% !important;\n    width: 40px !important;\n    height: 40px !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    cursor: pointer !important;\n    transition: all 0.3s ease !important;\n    font-size: 20px !important;\n    font-weight: bold !important;\n  ",ke.innerHTML="A-",ke.title="–£–º–µ–Ω—å—à–∏—Ç—å —à—Ä–∏—Ñ—Ç";const Fe=t.createElement("button");Fe.style.cssText="\n    background: rgba(0, 0, 0, 0.8) !important;\n    backdrop-filter: blur(10px) !important;\n    color: white !important;\n    border: 1px solid rgba(255, 255, 255, 0.2) !important;\n    border-radius: 50% !important;\n    width: 40px !important;\n    height: 40px !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    cursor: pointer !important;\n    transition: all 0.3s ease !important;\n    font-size: 20px !important;\n    font-weight: bold !important;\n  ",Fe.innerHTML="A+",Fe.title="–£–≤–µ–ª–∏—á–∏—Ç—å —à—Ä–∏—Ñ—Ç";const Pe=t.createElement("button");Pe.style.cssText="\n    background: rgba(0, 0, 0, 0.8) !important;\n    backdrop-filter: blur(10px) !important;\n    color: white !important;\n    border: 1px solid rgba(255, 255, 255, 0.2) !important;\n    border-radius: 50% !important;\n    width: 40px !important;\n    height: 40px !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    cursor: pointer !important;\n    transition: all 0.3s ease !important;\n    font-size: 18px !important;\n  ",Pe.innerHTML="üëÅÔ∏è",Pe.title="–û—Ç–∫–ª—é—á–∏—Ç—å –æ–≤–µ—Ä–ª–µ–π",Pe.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),c.stopImmediatePropagation(),q.value=!1}),ce.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),c.stopImmediatePropagation(),Xo(),setTimeout(()=>{Jo()},100)}),ke.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),c.stopImmediatePropagation();const P=F.value.fontSize||18;P>10&&(F.value={...F.value,fontSize:P-2})}),Fe.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),c.stopImmediatePropagation();const P=F.value.fontSize||18;P<36&&(F.value={...F.value,fontSize:P+2})}),[ce,Pe,ke,Fe].forEach(c=>{c.addEventListener("mouseenter",P=>{P.preventDefault(),P.stopPropagation(),P.stopImmediatePropagation(),c.style.background="#ff6b35",c.style.borderColor="#ff6b35",c.style.transform="scale(1.1)"}),c.addEventListener("mouseleave",P=>{P.preventDefault(),P.stopPropagation(),P.stopImmediatePropagation(),c.style.background="rgba(0, 0, 0, 0.8)",c.style.borderColor="rgba(255, 255, 255, 0.2)",c.style.transform="scale(1)"}),["mousedown","mouseup","mousemove","wheel","contextmenu"].forEach(P=>{c.addEventListener(P,O=>{O.preventDefault(),O.stopPropagation(),O.stopImmediatePropagation()})})}),["click","mousedown","mouseup","mousemove","wheel","contextmenu"].forEach(c=>{G.addEventListener(c,P=>{P.preventDefault(),P.stopPropagation(),P.stopImmediatePropagation()})}),G.appendChild(ke),G.appendChild(Fe),G.appendChild(ce),G.appendChild(Pe),H.appendChild(se),i.appendChild(p),i.appendChild(A),o.appendChild(i),o.appendChild(H),o.appendChild(G),G.style.transition="opacity 0.3s ease, visibility 0.3s ease",G.style.opacity="0",G.style.visibility="hidden",i.style.transition="opacity 0.3s ease";let Ke=null;const at=()=>{G.style.opacity="1",G.style.visibility="visible",i.style.opacity="0",F.value.showTimingsOnMouseMove&&ze.value.length>0&&(H.style.opacity="1",H.style.visibility="visible",clearTimeout(Ne),Ne=null,st.value||(Ne=setTimeout(()=>{H.style.opacity="0",H.style.visibility="hidden",Ne=null},3e3))),clearTimeout(Xe.value),clearTimeout(Ke),Xe.value=setTimeout(()=>{G.style.opacity="0",G.style.visibility="hidden"},3e3),Ke=setTimeout(()=>{i.style.opacity="1"},2e3)};t.addEventListener("mousemove",at),o.addEventListener("mouseenter",()=>{G.style.opacity="1",G.style.visibility="visible",i.style.opacity="0",clearTimeout(Ke)}),o.addEventListener("mouseleave",()=>{clearTimeout(Xe.value),clearTimeout(Ke),G.style.opacity="0",G.style.visibility="hidden",i.style.opacity="1"}),o._mouseHandler=at;const Le=(c=>{if(document.fullscreenElement===c||document.webkitFullscreenElement===c||c.webkitDisplayingFullscreen||c.offsetWidth===window.screen.width&&c.offsetHeight===window.screen.height)return t.body||t.documentElement;let O=c.parentNode,ye=0;const Be=5;for(;O&&ye<Be;){const me=t.defaultView.getComputedStyle(O),ie=O.getBoundingClientRect();if(ie.width>0&&ie.height>0&&(me.position==="relative"||me.position==="absolute"||me.position==="fixed"||O.tagName==="BODY"))return O;O=O.parentNode,ye++}return c.parentNode})(e);o._targetContainer=Le,o._videoElement=e,s=()=>{const c=o._videoElement,P=o._targetContainer;if(document.fullscreenElement===c||document.webkitFullscreenElement===c||c.webkitDisplayingFullscreen||c.offsetWidth===window.screen.width&&c.offsetHeight===window.screen.height)o.style.cssText="\n        position: fixed !important;\n        top: 0 !important;\n        left: 0 !important;\n        width: 100vw !important;\n        height: 100vh !important;\n        pointer-events: none !important;\n        z-index: 999999999 !important;\n        display: flex !important;\n        flex-direction: column !important;\n        justify-content: space-between !important;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n        visibility: visible !important;\n        opacity: 1 !important;\n        box-sizing: border-box !important;\n      ";else{const ye=t.defaultView.getComputedStyle(c),Be=P.getBoundingClientRect(),me=c.offsetWidth||c.clientWidth||parseFloat(ye.width)||0,ie=c.offsetHeight||c.clientHeight||parseFloat(ye.height)||0,De=c.getBoundingClientRect(),he=De.top-Be.top+P.scrollTop,Ge=De.left-Be.left+P.scrollLeft;o.style.cssText="\n        position: absolute !important;\n        top: ".concat(he,"px !important;\n        left: ").concat(Ge,"px !important;\n        width: ").concat(me,"px !important;\n        height: ").concat(ie,"px !important;\n        pointer-events: none !important;\n        z-index: 999999999 !important;\n        display: flex !important;\n        flex-direction: column !important;\n        justify-content: space-between !important;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n        visibility: visible !important;\n        opacity: 1 !important;\n        box-sizing: border-box !important;\n      ")}},e.style.position="relative",(Le.style.position===""||Le.style.position==="static")&&(Le.style.position="relative"),Le.appendChild(o),s(),f.value=o,Ae.value=!1;const rt=setInterval(()=>{if(!f.value||!q.value){clearInterval(rt);return}if(!t.body.contains(o))try{const O=t.querySelectorAll("video");if(O.length>0){const ye=O[0];o._videoElement=ye;const me=(ie=>{if(document.fullscreenElement===ie||document.webkitFullscreenElement===ie||ie.webkitDisplayingFullscreen||ie.offsetWidth===window.screen.width&&ie.offsetHeight===window.screen.height)return t.body||t.documentElement;let he=ie.parentNode,Ge=0;const u=5;for(;he&&Ge<u;){const vt=t.defaultView.getComputedStyle(he),no=he.getBoundingClientRect();if(no.width>0&&no.height>0&&(vt.position==="relative"||vt.position==="absolute"||vt.position==="fixed"||he.tagName==="BODY"))return he;he=he.parentNode,Ge++}return ie.parentNode})(ye);o._targetContainer=me,me.appendChild(o),s(),o._mouseHandler&&(t.removeEventListener("mousemove",o._mouseHandler),t.addEventListener("mousemove",o._mouseHandler))}}catch(O){console.log("Error re-adding overlay to DOM:",O)}const c=t.defaultView.getComputedStyle(o);if((c.visibility==="hidden"||c.display==="none"||c.opacity==="0")&&s(),(parseInt(c.zIndex)||0)<999999999&&s(),o._videoElement&&o._targetContainer){const O=o._videoElement,ye=t.defaultView.getComputedStyle(O),Be=document.fullscreenElement===O||document.webkitFullscreenElement===O||O.webkitDisplayingFullscreen||O.offsetWidth===window.screen.width&&O.offsetHeight===window.screen.height;let me,ie;Be?(me=window.innerWidth,ie=window.innerHeight):(me=O.offsetWidth||O.clientWidth||parseFloat(ye.width)||0,ie=O.offsetHeight||O.clientHeight||parseFloat(ye.height)||0);const De=parseInt(c.width)||0,he=parseInt(c.height)||0;(Math.abs(De-me)>5||Math.abs(he-ie)>5)&&s()}},1e3),ct=new window.MutationObserver(c=>{c.forEach(P=>{P.type==="attributes"&&P.target===o&&P.attributeName==="style"&&setTimeout(()=>{f.value&&q.value&&s()},100)})});ct.observe(o,{attributes:!0,attributeFilter:["style","class"]});const ut=()=>{f.value&&q.value&&s()},_e=()=>{f.value&&q.value&&setTimeout(()=>{s()},100)};t.defaultView.addEventListener("resize",ut),t.addEventListener("fullscreenchange",_e),t.addEventListener("webkitfullscreenchange",_e),e.addEventListener("webkitbeginfullscreen",_e),e.addEventListener("webkitendfullscreen",_e),o._monitorInterval=rt,o._mutationObserver=ct,o._resizeHandler=ut,o._fullscreenHandler=_e,o._iframeDoc=t;const dt=setInterval(()=>{if(!f.value||!q.value){clearInterval(dt);return}s()},500);setTimeout(()=>{clearInterval(dt)},1e4)},oo=()=>{var A,U,Q,pe,K;if(!f.value||!q.value)return;const t=b.value;if(!t)return;const e=t.contentDocument||t.contentWindow.document;if(!e)return;const o=f.value,s=o.children[0],i=o.children[1],p=e.defaultView.getComputedStyle(o);(p.display==="none"||p.visibility==="hidden")&&(o.style.display="flex !important",o.style.visibility="visible !important");const R=F.value.fontSize||18,h=s.children[0];if(h.style.fontSize="".concat(R+2,"px"),F.value.showTitle){h.style.display="block";const N=((A=d.movieInfo)==null?void 0:A.title)||((U=d.movieInfo)==null?void 0:U.name_ru)||((Q=d.movieInfo)==null?void 0:Q.name_en)||((pe=d.movieInfo)==null?void 0:pe.name_original)||"–ó–∞–≥—Ä—É–∑–∫–∞...",H=(K=d.movieInfo)!=null&&K.year?" (".concat(d.movieInfo.year,")"):"";h.textContent=N+H,F.value.showBackground?(h.style.background="rgba(0, 0, 0, 0.7) !important",h.style.backdropFilter="blur(10px) !important",h.style.width="fit-content !important",h.style.display="inline-block !important"):(h.style.background="transparent !important",h.style.backdropFilter="none !important",h.style.width="auto !important",h.style.display="inline-block !important")}else h.style.display="none";const a=s.children[1];a.style.fontSize="".concat(R,"px");let y="";if(F.value.showDuration2){const N=tt(Wt.value),H=tt(Vt.value);y="\n      <span style=\"font-family: 'Courier New', monospace; color: rgba(255, 255, 255, 0.6);\">".concat(N,'</span>\n      <span style="opacity: 0.6;">/</span>\n      <span style="font-family: \'Courier New\', monospace; color: rgba(255, 255, 255, 0.6);">').concat(H,"</span>\n    ")}if(ve.value.enabled&&ve.value.showObsInOverlay){let N="–û—Ç–∫–ª—é—á–µ–Ω";const H="#999999";if(Me.value)if(ve.value.selectedFilterId){const we=Je.value.find(se=>se.id===ve.value.selectedFilterId);we?N="".concat(we.filterName," (").concat(we.sceneName,")"):N="–§–∏–ª—å—Ç—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω"}else Je.value.length>0?N="–§–∏–ª—å—Ç—Ä –Ω–µ –≤—ã–±—Ä–∞–Ω":N="–§–∏–ª—å—Ç—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã";const de='\n      <span style="color: '.concat(H,';">\n        OBS: ').concat(N,"\n      </span>\n    ");y=y?"".concat(y," ").concat(de):de}if(y?(a.style.display="flex",a.innerHTML=y,F.value.showBackground?(a.style.background="rgba(0, 0, 0, 0.7) !important",a.style.backdropFilter="blur(10px) !important",a.style.borderRadius="6px !important",a.style.padding="8px 12px !important",a.style.width="fit-content !important",a.style.display="inline-flex !important"):(a.style.background="transparent !important",a.style.backdropFilter="none !important",a.style.borderRadius="0 !important",a.style.padding="0 !important",a.style.width="auto !important",a.style.display="flex !important")):a.style.display="none",ze.value.length>0){const N=i.children[0];N.style.fontSize="".concat(R-4,"px"),N.innerHTML="";const H=e.createElement("span");H.textContent="–¢–∞–π–º–∏–Ω–≥–∏: ",H.style.color="rgba(255, 255, 255, 0.6)",N.appendChild(H),ze.value.forEach((de,we)=>{if(we>0){const se=e.createElement("span");se.textContent=", ",se.style.color="rgba(255, 255, 255, 0.6)",N.appendChild(se)}de.intervals.forEach((se,G)=>{if(G>0){const ke=e.createElement("span");ke.textContent=", ",ke.style.color="rgba(255, 255, 255, 0.6)",N.appendChild(ke)}const ce=e.createElement("span");ce.textContent=se.text,se.status==="active"&&F.value.highlightTimings?(ce.style.color="#ff4444",ce.style.fontWeight="bold"):se.status==="upcoming"&&F.value.highlightTimings?(ce.style.color="#ff6b35",ce.style.fontWeight="500"):ce.style.color="rgba(255, 255, 255, 0.6)",N.appendChild(ce)})}),i.style.display="block",(!F.value.showTimingsOnMouseMove||st.value)&&(i.style.opacity="1",i.style.visibility="visible"),F.value.showBackground?(i.style.background="rgba(0, 0, 0, 0.7) !important",i.style.backdropFilter="blur(10px) !important",i.style.width="fit-content !important",i.style.minWidth="auto !important"):(i.style.background="transparent !important",i.style.backdropFilter="none !important",i.style.width="fit-content !important",i.style.minWidth="auto !important")}else i.style.display="none";F.value.showTimingsOnMouseMove&&st.value&&ze.value.length>0?(i.style.opacity="1",i.style.visibility="visible",clearTimeout(Ne)):F.value.showTimingsOnMouseMove&&!st.value&&ze.value.length>0&&i.style.opacity==="1"&&!Ne&&(Ne=setTimeout(()=>{i.style.opacity="0",i.style.visibility="hidden",Ne=null},3e3))},Re=()=>{if(f.value){try{f.value._monitorInterval&&clearInterval(f.value._monitorInterval),f.value._mutationObserver&&f.value._mutationObserver.disconnect(),f.value._resizeHandler&&f.value._iframeDoc&&f.value._iframeDoc.defaultView.removeEventListener("resize",f.value._resizeHandler),f.value._fullscreenHandler&&f.value._iframeDoc&&(f.value._iframeDoc.removeEventListener("fullscreenchange",f.value._fullscreenHandler),f.value._iframeDoc.removeEventListener("webkitfullscreenchange",f.value._fullscreenHandler),f.value._videoElement&&(f.value._videoElement.removeEventListener("webkitbeginfullscreen",f.value._fullscreenHandler),f.value._videoElement.removeEventListener("webkitendfullscreen",f.value._fullscreenHandler))),f.value._mouseHandler&&f.value._iframeDoc&&f.value._iframeDoc.removeEventListener("mousemove",f.value._mouseHandler),f.value.remove()}catch(t){console.log("Error removing overlay:",t)}f.value=null}Ae.value=!1,Xe.value&&(clearTimeout(Xe.value),Xe.value=null)};vo(()=>{if(re.value=!0,ko(),ft.value&&(Oe.value="4:3"),$t(),window.addEventListener("resize",$t),window.addEventListener("resize",It),it.value&&lt(),window.toggleCompressor=Yt,window.toggleMirror=jt,eo(),window.connectToOBS=Nt,window.testOBSBlur=Go,window.refreshOBSFilters=Yo,window.getOBSFiltersInfo=jo,window.testOBSConnection=Zo,window.debugOBS=()=>{var t;console.log("=== OBS Debug Info ==="),console.log("OBS Settings:",ve.value),console.log("OBS Connected:",Me.value),console.log("OBS Filters Found:",Je.value),console.log("OBS WebSocket instance:",J.value),J.value&&(console.log("WebSocket state:",(t=J.value.ws)==null?void 0:t.readyState),console.log("Is Connected:",J.value.isConnected),console.log("Is Authenticated:",J.value.isAuthenticated))},ve.value.enabled&&Nt(),C.value&&(Ct.value=setInterval(()=>{const t=window.overlayNudityTimings?window.overlayNudityTimings.length:0;t>yt.value?(yt.value=t,q.value||(q.value=!0,window.electronAPI&&window.electronAPI.showToast("–û–≤–µ—Ä–ª–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á—ë–Ω - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∏–Ω–≥–∏"))):yt.value=t},1e3)),C.value&&q.value){const t=()=>{if(b.value&&!f.value)try{const e=b.value,o=e.contentDocument||e.contentWindow.document;if(o){const s=o.querySelector("video");if(s){const i=Date.now()-(window.iframeLoadTime||0);i>=100?Qe(o,s):setTimeout(t,100-i)}}}catch(e){console.log("Error initializing overlay on mount:",e),Ae.value=!1}};setTimeout(t,1e3)}}),tn(()=>{window.removeEventListener("resize",$t),window.removeEventListener("resize",It),window.removeEventListener("mousemove",Bt),document.removeEventListener("keydown",Ft),document.body.classList.remove("no-scroll"),fe.value&&clearInterval(fe.value),ge.value&&clearInterval(ge.value),Ct.value&&clearInterval(Ct.value),Re(),Do(),to(),delete window.toggleCompressor,delete window.toggleMirror,delete window.connectToOBS,delete window.testOBSBlur,delete window.refreshOBSFilters,delete window.getOBSFiltersInfo,delete window.testOBSConnection,delete window.debugOBS,delete window.obsSources,delete window.obsFiltersFound});const Zo=async()=>J.value&&Me.value?await J.value.testConnection():{success:!1,error:"Not connected"};return(t,e)=>{var o,s,i,p,R,h,a,y,A,U,Q,pe,K,N,H,de,we,se,G,ce,ke,Fe,Pe,Ke,at,Ot,Le,Rt,rt,ct,ut,_e,dt,c,P,O,ye,Be,me,ie,De,he,Ge;return j.value?(w(),Lt(on,{key:0,message:j.value,code:He.value},null,8,["message","code"])):(w(),S(qe,{key:1},[n("div",Tn,[e[45]||(e[45]=n("span",null,"–ü–ª–µ–µ—Ä:",-1)),n("button",{class:"player-btn",onClick:xo},k(M.value?Qt(M.value.translate).toUpperCase():"–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–µ—Ä–æ–≤..."),1),Ht.value?(w(),S("button",{key:0,class:"source-btn",onClick:So},"–ò—Å—Ç–æ—á–Ω–∏–∫")):oe("",!0)]),z.value?(w(),Lt(In,{key:0,players:X.value,"selected-player":M.value,onClose:Gt,onSelect:qo},null,8,["players","selected-player"])):oe("",!0),E.value?(w(),S("div",{key:1,class:"source-modal-backdrop",onClick:pt(At,["self"])},[n("div",$n,[n("div",{class:"source-modal-header"},[e[46]||(e[46]=n("h3",null,"–í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ KinoBD",-1)),n("button",{class:"source-close-btn",onClick:At},"√ó")]),ne.value?(w(),S("div",An,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤...")):Z.value?(w(),S("div",Mn,k(Z.value),1)):Ce.value.length===0?(w(),S("div",Bn,"–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")):(w(),S("ul",Fn,[(w(!0),S(qe,null,nt(Ce.value,u=>(w(),S("li",{key:u.id},[n("button",{class:"source-candidate-btn",onClick:vt=>Co(u)},[n("span",Nn,k(u.title||"ID ".concat(u.id)),1),n("span",On,"inid: "+k(u.id)+" ¬∑ kp: "+k(u.kp_id||"-"),1)],8,Pn)]))),128))]))])])):oe("",!0),n("div",{ref_key:"containerRef",ref:I,class:_(["player-container",{"theater-mode":V.value}]),style:so(V.value?{}:bo.value)},[n("div",{class:"iframe-wrapper",style:so(V.value?{}:wo.value)},[ee(n("iframe",{ref_key:"playerIframe",ref:b,src:(o=M.value)==null?void 0:o.iframe,frameborder:"0",allowfullscreen:"",webkitallowfullscreen:"",class:_(["responsive-iframe",{"theater-mode-unlock":B.value,"theater-mode-lock":V.value,dimmed:kt.value}]),onLoad:No},null,42,Rn),[[te,!re.value&&((s=M.value)==null?void 0:s.iframe)]]),re.value?(w(),Lt(dn,{key:0,text:"–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–ª–µ–µ—Ä: ".concat(M.value?Qt(M.value.translate):"–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –ø–ª–µ–µ—Ä–æ–≤","\n–ï—Å–ª–∏ –ø–ª–µ–µ—Ä –Ω–µ –≥—Ä—É–∑–∏—Ç—Å—è, —Ç–æ —Å–º–µ–Ω–∏—Ç–µ –ø–ª–µ–µ—Ä –≤—ã—à–µ –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ VPN"),style:{"white-space":"pre-line"}},null,8,["text"])):oe("",!0)],4),V.value?(w(),S("button",{key:0,class:_(["close-theater-btn",{visible:B.value}]),onClick:wt}," ‚úñ ",2)):oe("",!0)],6),V.value?oe("",!0):(w(),S("div",Ln,[n("div",_n,[!ft.value&&$.value?(w(),S("div",{key:0,ref_key:"tooltipContainer",ref:fo,class:"tooltip-container list-buttons-container","data-tooltip-container":"favorite"},[Pt.value?(w(),S("button",{key:0,class:_(["favorite-btn",{active:(p=(i=D.movieInfo)==null?void 0:i.lists)==null?void 0:p.isFavorite}]),onMouseenter:e[0]||(e[0]=u=>le("favorite")),onMouseleave:Et,onClick:e[1]||(e[1]=u=>Ie(be(Y).FAVORITE))},[n("span",Dn,k((h=(R=D.movieInfo)==null?void 0:R.lists)!=null&&h.isFavorite?"favorite":"favorite_border"),1),n("span",{class:_(["material-icons dropdown-arrow",{highlighted:yo.value}])},"expand_more",2)],34)):oe("",!0),ee(n("div",{ref_key:"tooltip",ref:go,class:"custom-tooltip advanced-tooltip list-buttons-dropdown","data-tooltip":"favorite",onMouseenter:Tt,onMouseleave:ht},[n("div",qn,[n("button",{class:_(["favorite-btn",{active:(y=(a=D.movieInfo)==null?void 0:a.lists)==null?void 0:y.isFavorite}]),onClick:e[2]||(e[2]=u=>Ie(be(Y).FAVORITE))},[n("span",Hn,k((U=(A=D.movieInfo)==null?void 0:A.lists)!=null&&U.isFavorite?"favorite":"favorite_border"),1),e[47]||(e[47]=n("span",{class:"button-label"},"–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ",-1))],2)]),n("div",Wn,[n("button",{class:_(["watching-btn",{active:(pe=(Q=D.movieInfo)==null?void 0:Q.lists)==null?void 0:pe.isWatching}]),onClick:e[3]||(e[3]=u=>Ie(be(Y).WATCHING))},[n("span",Vn,k((N=(K=D.movieInfo)==null?void 0:K.lists)!=null&&N.isWatching?"visibility":"visibility_off"),1),e[48]||(e[48]=n("span",{class:"button-label"},"–°–º–æ—Ç—Ä—é",-1))],2)]),n("div",zn,[n("button",{class:_(["later-btn",{active:(de=(H=D.movieInfo)==null?void 0:H.lists)==null?void 0:de.isLater}]),onClick:e[4]||(e[4]=u=>Ie(be(Y).LATER))},[...e[49]||(e[49]=[n("span",{class:"material-icons"},"watch_later",-1),n("span",{class:"button-label"},"–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∑–∂–µ",-1)])],2)]),n("div",Un,[n("button",{class:_(["completed-btn",{active:(se=(we=D.movieInfo)==null?void 0:we.lists)==null?void 0:se.isCompleted}]),onClick:e[5]||(e[5]=u=>Ie(be(Y).COMPLETED))},[n("span",Kn,k((ce=(G=D.movieInfo)==null?void 0:G.lists)!=null&&ce.isCompleted?"check_circle":"check_circle_outline"),1),e[50]||(e[50]=n("span",{class:"button-label"},"–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ",-1))],2)]),n("div",Gn,[n("button",{class:_(["abandoned-btn",{active:(Fe=(ke=D.movieInfo)==null?void 0:ke.lists)==null?void 0:Fe.isAbandoned}]),onClick:e[6]||(e[6]=u=>Ie(be(Y).ABANDONED))},[n("span",Yn,k(((Ke=(Pe=D.movieInfo)==null?void 0:Pe.lists)!=null&&Ke.isAbandoned,"not_interested")),1),e[51]||(e[51]=n("span",{class:"button-label"},"–ë—Ä–æ—à–µ–Ω–æ",-1))],2)]),n("div",{class:"tooltip-hint"},[e[53]||(e[53]=n("span",{class:"material-icons"},"settings",-1)),n("span",null,[e[52]||(e[52]=Ye("–°—Ç–∏–ª—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ ",-1)),n("a",{class:"settings-link",onClick:zo},"–Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö")])])],544),[[te,T.value==="favorite"&&Pt.value]])],512)):oe("",!0),ft.value?oe("",!0):(w(),S(qe,{key:1},[n("div",jn,[n("button",{class:_(["dimming-btn",{active:kt.value}]),onMouseenter:e[7]||(e[7]=u=>le("dimming")),onMouseleave:e[8]||(e[8]=u=>T.value=null),onClick:Mo},[n("span",Xn,k(kt.value?"light_mode":"dark_mode"),1)],34),ee(n("div",{class:"custom-tooltip","data-tooltip":"dimming"},k(kt.value?"–û—Ç–∫–ª—é—á–∏—Ç—å –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ":"–í–∫–ª—é—á–∏—Ç—å –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ"),513),[[te,T.value==="dimming"]])]),n("div",Jn,[n("button",{class:_(["blur-btn",{"electron-only":!C.value}]),onMouseenter:e[9]||(e[9]=u=>le("blur")),onMouseleave:e[10]||(e[10]=u=>T.value=null),onClick:Ao},[...e[54]||(e[54]=[n("span",{class:"material-icons"},"blur_on",-1)])],34),ee(n("div",{class:"custom-tooltip","data-tooltip":"blur"},k(C.value?"–ë–ª—é—Ä":"–ë–ª—é—Ä, —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏"),513),[[te,T.value==="blur"]])]),n("div",Zn,[n("button",{class:_(["material-symbols-outlined",{active:Ue.value,"electron-only":!C.value}]),onMouseenter:e[11]||(e[11]=u=>le("compressor")),onMouseleave:e[12]||(e[12]=u=>T.value=null),onClick:Yt},[...e[55]||(e[55]=[n("span",{class:"material-icons"},"graphic_eq",-1)])],34),ee(n("div",{class:"custom-tooltip","data-tooltip":"compressor"},k(C.value?"–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä":"–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä, —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏"),513),[[te,T.value==="compressor"]])]),n("div",Qn,[n("button",{class:_(["mirror-btn",{active:Ze.value,"electron-only":!C.value}]),onMouseenter:e[13]||(e[13]=u=>le("mirror")),onMouseleave:e[14]||(e[14]=u=>T.value=null),onClick:jt},[...e[56]||(e[56]=[n("span",{class:"material-icons"},"flip",-1)])],34),ee(n("div",{class:"custom-tooltip","data-tooltip":"mirror"},k(C.value?"–ó–µ—Ä–∫–∞–ª–æ":"–ó–µ—Ä–∫–∞–ª–æ, —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏"),513),[[te,T.value==="mirror"]])]),n("div",es,[n("button",{class:"theater-mode-btn",onMouseenter:e[15]||(e[15]=u=>le("theater")),onMouseleave:e[16]||(e[16]=u=>T.value=null),onClick:wt},[n("span",ts,k(V.value?"fullscreen_exit":"aspect_ratio"),1)],32),ee(n("div",os,[Ye(k(V.value?"–í—ã–π—Ç–∏ –∏–∑ —Ç–µ–∞—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞":"–¢–µ–∞—Ç—Ä–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º")+" ",1),e[57]||(e[57]=n("span",{class:"shortcut-hint"},"Alt+T",-1))],512),[[te,T.value==="theater"]])]),n("div",ns,[n("button",{class:_(["pip-btn",{"electron-only":!C.value}]),onMouseenter:e[17]||(e[17]=u=>le("pip")),onMouseleave:e[18]||(e[18]=u=>T.value=null),onClick:Uo},[...e[58]||(e[58]=[n("span",{class:"material-icons"},"picture_in_picture_alt",-1)])],34),ee(n("div",{class:"custom-tooltip","data-tooltip":"pip"},k(C.value?"–ö–∞—Ä—Ç–∏–Ω–∫–∞ –≤ –∫–∞—Ä—Ç–∏–Ω–∫–µ":"–ö–∞—Ä—Ç–∏–Ω–∫–∞ –≤ –∫–∞—Ä—Ç–∏–Ω–∫–µ, —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏"),513),[[te,T.value==="pip"]])]),n("div",ss,[n("button",{class:"aspect-ratio-dropdown-btn",onMouseenter:e[19]||(e[19]=u=>le("aspect_ratio")),onMouseleave:Et,onClick:Ho},[n("span",is,k(Oe.value),1)],32),ee(n("div",{class:"custom-tooltip advanced-tooltip aspect-ratio-dropdown","data-tooltip":"aspect_ratio",onMouseenter:Tt,onMouseleave:ht},[(w(),S(qe,null,nt(xt,u=>n("div",{key:u,class:_(["aspect-ratio-option",{active:Oe.value===u}]),onClick:vt=>Jt(u)},k(u),11,ls)),64))],544),[[te,T.value==="aspect_ratio"]])]),n("div",{class:"tooltip-container","data-tooltip-container":"centering",onMouseenter:e[21]||(e[21]=u=>le("centering")),onMouseleave:Et},[n("button",{class:"center-btn",onClick:lt},[...e[59]||(e[59]=[n("span",{class:"material-icons"},"center_focus_strong",-1)])]),ee(n("div",{class:"custom-tooltip advanced-tooltip","data-tooltip":"centering",onMouseenter:Tt,onMouseleave:ht},[e[60]||(e[60]=Ye(" –û—Ç—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–µ–µ—Ä ",-1)),Dt(pn,{modelValue:it.value,"onUpdate:modelValue":e[20]||(e[20]=u=>it.value=u),title:"–ê–≤—Ç–æ—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–µ–µ—Ä–∞"},null,8,["modelValue"]),e[61]||(e[61]=n("span",{class:"tooltip-title"},"–ê–≤—Ç–æ—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–µ–µ—Ä–∞",-1))],544),[[te,T.value==="centering"]])],32),!C.value&&$.value?(w(),S("div",as,[n("button",{class:"app-link-btn",onMouseenter:e[22]||(e[22]=u=>le("app_link")),onMouseleave:e[23]||(e[23]=u=>T.value=null),onClick:Oo},[...e[62]||(e[62]=[n("span",{class:"material-icons"},"open_in_new",-1)])],32),ee(n("div",rs," –û—Ç–∫—Ä—ã—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ",512),[[te,T.value==="app_link"]])])):oe("",!0),(at=M.value)!=null&&at.iframe?(w(),S("div",cs,[n("button",{class:"mpv-btn",onMouseenter:e[24]||(e[24]=u=>le("mpv")),onMouseleave:e[25]||(e[25]=u=>T.value=null),onClick:Lo},[...e[63]||(e[63]=[n("span",{class:"material-icons"},"terminal",-1)])],32),ee(n("div",us," –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è mpv ",512),[[te,T.value==="mpv"]])])):oe("",!0),C.value?(w(),S("div",ds,[n("button",{class:"copy-link-btn",onMouseenter:e[26]||(e[26]=u=>le("copy_link")),onMouseleave:e[27]||(e[27]=u=>T.value=null),onClick:_o},[...e[64]||(e[64]=[n("span",{class:"material-icons"},"content_copy",-1)])],32),ee(n("div",vs," –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É ",512),[[te,T.value==="copy_link"]])])):oe("",!0),C.value?(w(),S("div",ps,[n("button",{class:_(["overlay-btn",{active:q.value}]),onMouseenter:e[28]||(e[28]=u=>le("overlay")),onMouseleave:e[29]||(e[29]=u=>T.value=null),onClick:Ko},[n("span",ms,k(q.value?"layers":"layers_clear"),1)],34),ee(n("div",{class:"custom-tooltip","data-tooltip":"overlay"},k(q.value?"–°–∫—Ä—ã—Ç—å –æ–≤–µ—Ä–ª–µ–π –≤–∏–¥–µ–æ":"–ü–æ–∫–∞–∑–∞—Ç—å –æ–≤–µ—Ä–ª–µ–π –≤–∏–¥–µ–æ"),513),[[te,T.value==="overlay"]])])):oe("",!0)],64))]),!ft.value&&!Pt.value&&$.value?(w(),S("div",fs,[n("div",gs,[n("button",{class:_(["favorite-btn",{active:(Le=(Ot=D.movieInfo)==null?void 0:Ot.lists)==null?void 0:Le.isFavorite}]),onMouseenter:e[30]||(e[30]=u=>le("favorite")),onMouseleave:e[31]||(e[31]=u=>T.value=null),onClick:e[32]||(e[32]=u=>Ie(be(Y).FAVORITE))},[n("span",ys,k((rt=(Rt=D.movieInfo)==null?void 0:Rt.lists)!=null&&rt.isFavorite?"favorite":"favorite_border"),1)],34),ee(n("div",hs,k("–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"),512),[[te,T.value==="favorite"]])]),n("div",bs,[n("button",{class:_(["watching-btn",{active:(ut=(ct=D.movieInfo)==null?void 0:ct.lists)==null?void 0:ut.isWatching}]),onMouseenter:e[33]||(e[33]=u=>le("watching")),onMouseleave:e[34]||(e[34]=u=>T.value=null),onClick:e[35]||(e[35]=u=>Ie(be(Y).WATCHING))},[n("span",ws,k((dt=(_e=D.movieInfo)==null?void 0:_e.lists)!=null&&dt.isWatching?"visibility":"visibility_off"),1)],34),ee(n("div",ks,k("–°–º–æ—Ç—Ä—é"),512),[[te,T.value==="watching"]])]),n("div",xs,[n("button",{class:_(["later-btn",{active:(P=(c=D.movieInfo)==null?void 0:c.lists)==null?void 0:P.isLater}]),onMouseenter:e[36]||(e[36]=u=>le("later")),onMouseleave:e[37]||(e[37]=u=>T.value=null),onClick:e[38]||(e[38]=u=>Ie(be(Y).LATER))},[...e[65]||(e[65]=[n("span",{class:"material-icons"},"watch_later",-1)])],34),ee(n("div",Ss,k("–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∑–∂–µ"),512),[[te,T.value==="later"]])]),n("div",Cs,[n("button",{class:_(["completed-btn",{active:(ye=(O=D.movieInfo)==null?void 0:O.lists)==null?void 0:ye.isCompleted}]),onMouseenter:e[39]||(e[39]=u=>le("completed")),onMouseleave:e[40]||(e[40]=u=>T.value=null),onClick:e[41]||(e[41]=u=>Ie(be(Y).COMPLETED))},[n("span",Is,k((me=(Be=D.movieInfo)==null?void 0:Be.lists)!=null&&me.isCompleted?"check_circle":"check_circle_outline"),1)],34),ee(n("div",Es,k("–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ"),512),[[te,T.value==="completed"]])]),n("div",Ts,[n("button",{class:_(["abandoned-btn",{active:(De=(ie=D.movieInfo)==null?void 0:ie.lists)==null?void 0:De.isAbandoned}]),onMouseenter:e[42]||(e[42]=u=>le("abandoned")),onMouseleave:e[43]||(e[43]=u=>T.value=null),onClick:e[44]||(e[44]=u=>Ie(be(Y).ABANDONED))},[n("span",$s,k(((Ge=(he=D.movieInfo)==null?void 0:he.lists)!=null&&Ge.isAbandoned,"not_interested")),1)],34),ee(n("div",As,k("–ë—Ä–æ—à–µ–Ω–æ"),512),[[te,T.value==="abandoned"]])])])):oe("",!0)])),Dt(po,{ref_key:"notificationRef",ref:Ee},null,512)],64))}}},Gs=qt(Ms,[["__scopeId","data-v-3a9fab9d"]]),Bs={class:"rating-container"},Fs={class:"rating-display"},Ps={class:"rating-numbers"},Ns=["onClick","onMouseenter"],Os={key:0,class:"tooltip-footer"},Rs={class:"rating-numbers mobile-rating-numbers"},Ls=["onClick"],_s={key:0,class:"mobile-modal-footer"},Ds={__name:"MovieRating",props:{kpId:{type:String,required:!0},showDash:{type:Boolean,default:!1}},setup(D){const l=co(),v=uo(),r=D,g=m(null),x=m(null),L=m(null),$=m(null),d=m(0),W=m(!1),X=m(!1);let M=null;const re=ne=>ne?ne.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "):"0",V=()=>{M=setTimeout(()=>{W.value=!1,l.isMobile||(X.value=!1)},100)},B=()=>{M&&(clearTimeout(M),M=null),W.value=!0},b=()=>{l.isMobile&&(X.value=!X.value)},I=()=>{v.push("/login")},z=async()=>{try{const ne=await un(r.kpId);x.value=ne.user_rating,L.value=ne.average_rating,$.value=re(ne.vote_count)}catch(ne){console.error("Error loading rating:",ne)}},E=async ne=>{var Z;try{ne===x.value?(await ro(r.kpId,null),x.value=null,g.value.showNotification("–û—Ü–µ–Ω–∫–∞ —É–¥–∞–ª–µ–Ω–∞")):(await ro(r.kpId,ne),x.value=ne,g.value.showNotification("–û—Ü–µ–Ω–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞")),l.isMobile&&(X.value=!1),z()}catch(j){console.error("Error setting rating:",j),((Z=j.response)==null?void 0:Z.status)===401?g.value.showNotification('–î–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <a class="auth-link">–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</a>',5e3,{onClick:I}):g.value.showNotification("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ü–µ–Ω–∫–∏"),l.isMobile&&(X.value=!1)}},Ce=()=>{X.value=!1};return vo(()=>{z()}),(ne,Z)=>(w(),S("div",Bs,[n("div",Fs,[n("a",{href:"#",class:_(["rating-link",{"has-rating":x.value}]),onMouseenter:Z[0]||(Z[0]=j=>W.value=!0),onMouseleave:V,onClick:pt(b,["prevent"])},[Z[3]||(Z[3]=n("img",{src:mn,alt:"ReYohoho",class:"rating-logo"},null,-1)),n("span",{class:_(["average-rating",be(cn)(L.value)])},k(L.value?L.value.toFixed(1).replace(/\.0$/,""):"‚Äî"),3)],34),ee(n("div",{class:"rating-tooltip",onMouseenter:B,onMouseleave:V},[n("div",Ps,[(w(),S(qe,null,nt(10,j=>n("button",{key:j,class:_(["number-btn",{active:j===x.value,hover:j===d.value,"average-highlight":L.value&&j<=Math.round(L.value)}]),onClick:He=>E(j),onMouseenter:He=>d.value=j,onMouseleave:Z[1]||(Z[1]=He=>d.value=0)},k(j),43,Ns)),64))]),$.value?(w(),S("div",Os,"–û—Ü–µ–Ω–æ–∫: "+k($.value),1)):oe("",!0)],544),[[te,(W.value||X.value)&&!be(l).isMobile]])]),Dt(po,{ref_key:"notificationRef",ref:g},null,512),be(l).isMobile&&X.value?(w(),S("div",{key:0,class:"mobile-modal-overlay",onClick:Ce},[n("div",{class:"mobile-modal",onClick:Z[2]||(Z[2]=pt(()=>{},["stop"]))},[n("div",{class:"mobile-modal-header"},[Z[4]||(Z[4]=n("h3",null,"–û—Ü–µ–Ω–∏—Ç—å —Ñ–∏–ª—å–º",-1)),n("button",{class:"close-button",onClick:Ce},"√ó")]),n("div",Rs,[(w(),S(qe,null,nt(10,j=>n("button",{key:j,class:_(["number-btn",{active:j===x.value,"average-highlight":L.value&&j<=Math.round(L.value)}]),onClick:He=>E(j)},k(j),11,Ls)),64))]),$.value?(w(),S("div",_s,"–û—Ü–µ–Ω–æ–∫: "+k($.value),1)):oe("",!0)])])):oe("",!0)]))}},Ys=qt(Ds,[["__scopeId","data-v-2df64bd5"]]);export{Ys as M,Gs as P,Us as _,Ks as a};
